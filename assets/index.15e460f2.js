var ne=Object.defineProperty;var ae=(i,s,e)=>s in i?ne(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e;var r=(i,s,e)=>(ae(i,typeof s!="symbol"?s+"":s,e),e);import{r as x,j as he}from"./js/app-2192e739.js";var B=(i=>(i.UpdateLeaderboard="UPDATE_LEADERBOARD",i))(B||{}),u=(i=>(i.UP="UP",i.DOWN="DOWN",i.LEFT="LEFT",i.RIGHT="RIGHT",i))(u||{}),y=(i=>(i[i.Low=0]="Low",i[i.Medium=1]="Medium",i[i.High=2]="High",i))(y||{}),a=(i=>(i.MOVE="move",i.STOP="stop",i.SLIDE="slide",i.SPAWN="spawn",i.DESPAWN="despawn",i.READY="ready",i.DAMAGED="damaged",i.DESTROYED="destroyed",i.EXPLODING="exploding",i.SHOOT="shoot",i.SET_LOOP_DELAY="setLoopDelay",i.SET_LOOP_INTERVAL="setLoopInterval",i.CLEAR_LOOP_INTERVAL="clearLoopInterval",i.WILL_HAVE_NEW_POS="entityWillHaveNewPos",i.WILL_DO_DAMAGE="entityWillDoDamage",i.SHOULD_BE_DESTROYED="entityShouldBeDestroyed",i.SHOULD_UPDATE="entityShouldUpdate",i.DID_UPDATE="entityDidUpdate",i.SHOULD_RENDER_TEXT="entityShouldRenderText",i.ANIMATION_STARTED="animationStarted",i.ANIMATION_ENDED="animationEnded",i))(a||{}),T=(i=>(i[i.SINGLEPLAYER=0]="SINGLEPLAYER",i[i.MULTIPLAYER=1]="MULTIPLAYER",i))(T||{}),E=(i=>(i.Loading="LOADING",i.MainMenu="MAIN_MENU",i.LevelSelector="LEVEL_SELECTOR",i.GameStart="GAME_START",i.Pause="PAUSE",i.Score="SCORE",i.GameOverPopup="GAME_OVER",i))(E||{}),L=(i=>(i.PLAYER1="PLAYER1",i.PLAYER2="PLAYER2",i))(L||{}),f=(i=>(i.GAME_OVER="game_over",i.MISSION_ACCOMPLISHED="mission_accomplished",i.TANK_PLAYER_SPAWNED="tank_player_spawned",i.TANK_PLAYER_DESTROYED="tank_player_destroyed",i.TANK_ENEMY_SPAWNED="tank_enemy_spawned",i.TANK_ENEMY_DESTROYED="tank_enemy_destroyed",i.PROJECTILE_HIT="projectile_hit",i))(f||{}),p=(i=>(i[i.BLANK=0]="BLANK",i[i.FOREST=11]="FOREST",i[i.ICE=12]="ICE",i[i.WATER=13]="WATER",i[i.BASE=15]="BASE",i[i.BRICK=1]="BRICK",i[i.BRICK_TOP=2]="BRICK_TOP",i[i.BRICK_RIGHT=3]="BRICK_RIGHT",i[i.BRICK_BOTTOM=4]="BRICK_BOTTOM",i[i.BRICK_LEFT=5]="BRICK_LEFT",i[i.BRICK_LEFT_BOTTOM=17]="BRICK_LEFT_BOTTOM",i[i.BRICK_RIGHT_BOTTOM=18]="BRICK_RIGHT_BOTTOM",i[i.CONCRETE=6]="CONCRETE",i[i.CONCRETE_TOP=7]="CONCRETE_TOP",i[i.CONCRETE_RIGHT=8]="CONCRETE_RIGHT",i[i.CONCRETE_BOTTOM=9]="CONCRETE_BOTTOM",i[i.CONCRETE_LEFT=10]="CONCRETE_LEFT",i[i.CONCRETE_LEFT_BOTTOM=19]="CONCRETE_LEFT_BOTTOM",i[i.CONCRETE_RIGHT_BOTTOM=20]="CONCRETE_RIGHT_BOTTOM",i))(p||{}),d=(i=>(i.STOP="stop",i.MOVE="move",i.SHOOT="shoot",i.PAUSE="pause",i.FULLSCREEN="fullscreen",i.MUTE="mute",i.ESCAPE="escape",i))(d||{});class A{constructor(){r(this,"listeners",{})}on(s,e){return this.listeners[s]||(this.listeners[s]=[]),this.listeners[s].push(e),this}emit(s,...e){var t;(t=this.listeners[s])==null||t.forEach(o=>{o.apply(this,e)})}off(s,e){var t;return this.listeners[s]=(t=this.listeners[s])==null?void 0:t.filter(o=>o!==e),this}offAll(s){return delete this.listeners[s],this}clearAllListeners(){Object.keys(this.listeners).forEach(s=>{delete this.listeners[s]})}}const K=i=>!!(i%2);function F(i,s){return Math.floor(Math.random()*(s-i+1))+i}async function le(i=100){return new Promise(s=>setTimeout(s,i))}class N extends A{constructor(e){super();r(this,"activeDirection",{});r(this,"shootProcess",null);r(this,"shootIntervalMs",200);this.keyBindings=e}load(){this.registerEvents()}unload(){this.disableEvents()}reset(){return this.clearAllListeners(),this}registerEvents(){this.keydown=this.keydown.bind(this),this.keyup=this.keyup.bind(this),document.addEventListener("keydown",this.keydown),document.addEventListener("keyup",this.keyup)}disableEvents(){document.removeEventListener("keydown",this.keydown),document.removeEventListener("keyup",this.keyup)}getKeyBinding(e){return this.keyBindings[e]||null}keydown(e){if(e.repeat)return!1;const t=this.getKeyBinding(e.code);t&&(this.keyPressed(t),this.preventDefaultEvent(e))}keyup(e){const t=this.getKeyBinding(e.code);t&&(this.keyReleased(t),this.preventDefaultEvent(e))}keyPressed([e,t]){e===d.MOVE&&(this.activeDirection[t]=!0),this.emit(e,t),e===d.SHOOT&&(this.shootProcess&&(clearInterval(this.shootProcess),this.shootProcess=null),this.shootProcess=setInterval(()=>{this.emit(e)},this.shootIntervalMs))}keyReleased([e,t]){if(e===d.MOVE){delete this.activeDirection[t];const o=Object.keys(this.activeDirection);o.length?this.emit(e,o[0]):this.emit(d.STOP)}e===d.SHOOT&&this.shootProcess&&(clearInterval(this.shootProcess),this.shootProcess=null)}preventDefaultEvent(e){!e.ctrlKey&&!e.shiftKey&&!e.altKey&&e.preventDefault()}}var c=(i=>(i.Yellow="yellow",i.Lime="lime",i.Black="black",i.Grey="#636363",i.LightGrey="lightgrey",i.Orange="orange",i.Red="red",i.White="white",i.Transparent="transparent",i.LightCyan="lightcyan",i.Aqua="aqua",i.Brown="brown",i.Green="green",i.Blue="blue",i.AliceBlue="aliceblue",i.Pink="#483D8B",i))(c||{});class R{constructor(s){this.overlay=s}}class ce extends R{show(){this.overlay.animate(this.updateStage.bind(this))}updateStage(s=0){const{view:e}=this.overlay,t=5,o=e.height-s,n=(e.height-t)/2,h=s<=10?s*.05:.5;return o<n?!1:(this.overlay.clearScreen(),this.overlay.renderElement({posX:0,posY:0,width:e.width,height:e.height,color:`rgba(0,0,0,${h})`}),this.overlay.renderElement({posX:0,posY:o,width:e.width,height:t,text:"\u041F\u041E\u0422\u0420\u0410\u0427\u0415\u041D\u041E",color:c.Red,align:"center"}),!0)}}class ue extends R{show(){this.overlay.animate(this.updateStage.bind(this))}updateStage(s=0){const{view:e}=this.overlay,t=e.width,o=Math.round(e.height/2)-s;return o<0?!1:(this.overlay.clearScreen(),this.overlay.renderElement({posX:0,posY:0,width:t,height:o,color:c.Grey}),this.overlay.renderElement({posX:0,posY:o+s*2,width:t,height:o,color:c.Grey}),!0)}}class de extends R{show({level:s,showHints:e=!0}){this.overlay.renderSplashScreen(c.Grey);const t=`\u0423\u0420\u041E\u0412\u0415\u041D\u042C ${s.toString().padStart(2," ")}`;this.overlay.renderElement({posX:0,posY:Math.round(this.overlay.view.height/2)-2,width:this.overlay.view.width,height:2,color:c.Black,text:t,align:"center"}),e&&(this.overlay.renderElement({posX:0,posY:50,width:this.overlay.view.width,height:1,color:c.Black,text:"\u0414\u041B\u042F \u0412\u042B\u0411\u041E\u0420\u0410 \u0423\u0420\u041E\u0412\u041D\u042F \u0412\u041E\u0421\u041F\u041E\u041B\u042C\u0417\u0423\u0419\u0422\u0415\u0421\u042C",align:"center"}),this.overlay.renderElement({posX:0,posY:52,width:this.overlay.view.width,height:1,color:c.Black,text:"\u0421\u0422\u0420\u0415\u041B\u041A\u0410\u041C\u0418 \u0412\u0412\u0415\u0420\u0425 \u0418 \u0412\u041D\u0418\u0417",align:"center"}))}}class pe extends R{show(){this.overlay.renderSplashScreen(),this.overlay.renderElement({posX:0,posY:26,width:this.overlay.view.width,height:4,color:c.White,text:"\u0417\u0410\u0413\u0420\u0423\u0417\u041A\u0410...",align:"center"})}}class me extends R{constructor(){super(...arguments);r(this,"tankElemInterval",null);r(this,"mainMenuStateYPos",{[T.SINGLEPLAYER]:32,[T.MULTIPLAYER]:37})}show(e){this.render();const t=-1;this.overlay.renderElement({posX:17,posY:this.mainMenuStateYPos[e]+t,width:4,height:4,color:c.Yellow,mainSpriteCoordinates:m["tank.player.primary.a"].RIGHT}).startAnimation({delay:25,spriteCoordinates:m["tank.player.primary.a"].RIGHT,name:"menuTank",looped:!0})}render(){const{view:e}=this.overlay;this.overlay.renderSplashScreen(),this.overlay.renderElement({posX:0,posY:12,width:e.width,height:7,backImg:O.getImage("brickBg"),text:"\u0422\u0410\u041D\u0427\u0418\u041A\u0418",align:"center"}),this.overlay.renderElement({posX:0,posY:21,width:e.width,height:7,backImg:O.getImage("brickBg"),text:"2023",align:"center"}),this.overlay.renderElement({posX:23,posY:this.mainMenuStateYPos[T.SINGLEPLAYER],width:20,height:2.2,color:c.White,text:"1 \u0418\u0413\u0420\u041E\u041A"}),this.overlay.renderElement({posX:23,posY:this.mainMenuStateYPos[T.MULTIPLAYER],width:20,height:2.2,color:c.White,text:"2 \u0418\u0413\u0420\u041E\u041A\u0410"}),this.overlay.renderElement({posX:0,posY:50,width:e.width,height:1,color:c.LightGrey,text:"WASD \u0418\u041B\u0418 \u0421\u0422\u0420\u0415\u041B\u041A\u0418 \u0414\u041B\u042F \u0414\u0412\u0418\u0416\u0415\u041D\u0418\u042F",align:"center"}),this.overlay.renderElement({posX:0,posY:52,width:e.width,height:1,color:c.LightGrey,text:"\u041F\u0420\u041E\u0411\u0415\u041B \u0418\u041B\u0418 \u0412\u0412\u041E\u0414 \u0414\u041B\u042F \u0421\u0422\u0420\u0415\u041B\u042C\u0411\u042B",align:"center"})}}class Ee extends R{show(){this.showPause(1),this.overlay.animate(this.animatePause.bind(this),500)}animatePause(s=0){const e=K(s)?0:1;return this.overlay.clearScreen(),this.overlay.game.paused?(this.showPause(e),!0):!1}showPause(s){const{view:e}=this.overlay,t=5;this.overlay.renderElement({posX:0,posY:0,width:e.width,height:e.height,color:"rgba(0,0,0,.5)"}),this.overlay.renderElement({posX:0,posY:(e.height-t)/2,width:e.width,height:t,text:"\u041F\u0410\u0423\u0417\u0410",color:`rgba(255,0,0,${s})`,align:"center"})}}class ge extends R{constructor(){super(...arguments);r(this,"animationInterval",150);r(this,"mode");r(this,"sizing");r(this,"currentPosY",0);r(this,"enemyTankSprites",[m["tank.enemy.default.a"].UP,m["tank.enemy.default.b"].UP,m["tank.enemy.default.c"].UP,m["tank.enemy.default.d"].UP]);r(this,"level");r(this,"sessionScore");r(this,"mapEnemiesKilledTotal");r(this,"mapEnemiesKilledCount");r(this,"mapEnemiesKilledScore");r(this,"categories");r(this,"allowedItemsCounter")}show(e){this.sizing={full:this.overlay.view.width,half:Math.round(this.overlay.view.width/2),third:Math.round(this.overlay.view.width/3)},this.mode=e.mode,this.level=e.level,this.sessionScore=e.sessionScore,this.mapEnemiesKilledTotal=e.mapEnemiesKilledTotal,this.mapEnemiesKilledCount=Object.values(e.mapEnemiesKilledCount),this.mapEnemiesKilledScore=Object.values(e.mapEnemiesKilledScore),this.categories=this.mapEnemiesKilledCount.length,this.allowedItemsCounter=new Array(this.categories).fill(-1),e.skip?(this.allowedItemsCounter=new Array(this.categories).fill(20),this.update()):this.overlay.animate(this.update.bind(this),this.animationInterval)}update(e=0){if(e>27)return!1;this.overlay.clearScreen(),this.overlay.renderSplashScreen(),this.renderHeader(),this.currentPosY=20;let t=!1;for(let o=0;o<this.categories;++o){const n=this.enemyTankSprites[o];if(o!==0&&this.allowedItemsCounter[o]===-1){this.renderCategory({score:[" "," "],count:[" "," "],enemyTankSprite:n});continue}const l=0,g=1;let v=this.mapEnemiesKilledScore[o];const S=[...this.mapEnemiesKilledCount[o]];let I=Math.max(...v)/Math.max(...S);(isNaN(I)||I===1/0)&&(I=1);const te=this.allowedItemsCounter[o]>Math.max(...S),se=typeof this.allowedItemsCounter[o+1]<"u",ie=this.allowedItemsCounter[o+1]===-1;if(te)se?ie&&(this.allowedItemsCounter[o+1]=0):t=!0;else{++this.allowedItemsCounter[o];const oe=this.allowedItemsCounter[o]<S[l],re=this.allowedItemsCounter[o]<S[g];oe&&(S[l]=this.allowedItemsCounter[o]),re&&(S[g]=this.allowedItemsCounter[o]),this.allowedItemsCounter[o]>0&&this.allowedItemsCounter[o]<=Math.max(...S)&&this.overlay.emit("score")}v=[S[l]*I,S[g]*I],this.renderCategory({score:v,count:S,enemyTankSprite:n})}return this.renderFooter({count:t?this.mapEnemiesKilledTotal:[" "," "]}),!0}renderHeader(){this.overlay.renderElement({posX:0,posY:12,width:this.sizing.full,height:2,align:"center",color:c.White,text:`\u0423\u0420\u041E\u0412\u0415\u041D\u042C ${this.level}`}),this.overlay.renderElement({posX:0,posY:16,width:this.sizing.third,height:2,align:"right",color:c.Red,text:"\u0418\u0413\u0420\u041E\u041A 1"}),this.overlay.renderElement({posX:0,posY:20,width:this.sizing.third,height:2,align:"right",color:c.Orange,text:`${this.sessionScore[0]}`}),this.mode!=="SINGLEPLAYER"&&(this.overlay.renderElement({posX:this.sizing.third*2,posY:16,width:this.sizing.third,height:2,align:"left",color:c.Red,text:"\u0418\u0413\u0420\u041E\u041A 2"}),this.overlay.renderElement({posX:this.sizing.third*2,posY:20,width:this.sizing.third,height:2,align:"left",color:c.Orange,text:`${this.sessionScore[1]}`}))}renderCategory({score:e,count:t,enemyTankSprite:o}){this.currentPosY+=5,this.overlay.renderElement({posX:0,posY:this.currentPosY,width:this.sizing.third,height:2,align:"right",color:"white",text:`${e[0]} \u041E\u0427\u041A\u041E\u0412`}),this.overlay.renderElement({posX:0,posY:this.currentPosY,width:this.sizing.half-1.5,height:2,align:"right",color:c.White,text:`${t[0]}<`}),this.overlay.renderElement({posX:this.sizing.half-1,posY:this.currentPosY-.8,width:3,height:3,mainSpriteCoordinates:o}),this.mode!=="SINGLEPLAYER"&&(this.overlay.renderElement({posX:this.sizing.half+2.5,posY:this.currentPosY,width:this.sizing.half-2.5,height:2,align:"left",color:c.White,text:`>${t[1]}`}),this.overlay.renderElement({posX:this.sizing.third*2,posY:this.currentPosY,width:this.sizing.third,height:2,align:"left",color:c.White,text:`${e[1]} \u041E\u0427\u041A\u041E\u0412`}))}renderFooter({count:e}){this.overlay.renderElement({posX:this.sizing.third+2,posY:this.currentPosY+3.5,width:this.sizing.third-4,height:.5,color:c.White}),this.overlay.renderElement({posX:0,posY:this.currentPosY+5,width:this.sizing.third,height:2,align:"right",color:c.White,text:"\u0412\u0421\u0415\u0413\u041E"}),this.overlay.renderElement({posX:0,posY:this.currentPosY+5,width:this.sizing.half-1.5,height:2,align:"right",color:"white",text:`${e[0]} `}),this.mode!=="SINGLEPLAYER"&&(this.overlay.renderElement({posX:this.sizing.half+2.5,posY:this.currentPosY+5,width:this.sizing.half-2.5,height:2,align:"left",color:c.White,text:` ${e[1]}`}),this.overlay.renderElement({posX:this.sizing.third*2,posY:this.currentPosY+5,width:this.sizing.third,height:2,align:"left",color:c.White,text:"\u0412\u0421\u0415\u0413\u041E"}))}}const fe={flag:[[1532,736,64,60]],"base.heart.alive":[[1244,128,64,64]],"base.heart.dead":[[1308,128,64,64]],"terrain.trees":[[1117,128,63,63]],"terrain.ice":[[1180,128,63,63]],"terrain.concrete":{WHOLE:[[1052,64,64,64]],TOP:[[1052,64,64,32]],BOTTOM:[[1052,64,64,32]],LEFT:[[1052,64,32,64]],RIGHT:[[1052,64,32,64]],LEFT_BOTTOM:[[1052,64,32,32]],RIGHT_BOTTOM:[[1052,64,32,32]]},"terrain.brick":{WHOLE:[[1052,0,64,64]],TOP:[[1052,0,64,32]],BOTTOM:[[1052,0,64,32]],LEFT:[[1052,0,32,64]],RIGHT:[[1052,0,32,64]],LEFT_BOTTOM:[[1052,0,32,32]],RIGHT_BOTTOM:[[1052,0,32,32]]},"terrain.water":[[1117,192,63,63],[1053,192,63,63]],"terrain.menu-brick":[[0,0,16,16],[16,0,16,16]],"terrain.inverse-brick":[[0,0,16,16],[16,0,16,16]],"terrain.blue-brick":[[0,0,16,16],[16,0,16,16]],projectile:{UP:[[1312,405,28,28],[1312,405,28,28]],RIGHT:[[1407,400,28,28],[1407,400,28,28]],DOWN:[[1377,405,28,28],[1377,405,28,28]],LEFT:[[1342,400,28,28],[1342,400,28,28]]},projectileExplosion:[[1052,512,64,64],[1116,512,64,64],[1180,512,64,64]],tankExplosion:[[1244,512,128,128],[1372,512,128,128],[1244,512,128,128],[1372,512,128,128]],shield:[[1052,576,64,64],[1116,576,64,64]],spawn:[[1050,380,65,65],[1116,380,65,65],[1180,380,65,65],[1244,380,65,65]],"tank.enemy.default.a":{UP:[[524,264,52,60],[588,264,52,60]],DOWN:[[780,264,52,60],[844,264,52,60]],LEFT:[[648,272,60,52],[712,272,60,52]],RIGHT:[[908,268,60,52],[972,268,60,52]]},"tank.enemy.default.b":{UP:[[524,328,52,60],[588,328,52,60]],DOWN:[[780,332,52,60],[844,332,52,60]],LEFT:[[648,336,60,52],[712,336,60,52]],RIGHT:[[908,332,60,52],[972,332,60,52]]},"tank.enemy.default.c":{UP:[[524,396,52,60],[588,396,52,60]],DOWN:[[776,396,52,60],[840,396,52,60]],LEFT:[[648,404,60,52],[712,404,60,52]],RIGHT:[[908,400,60,52],[972,400,60,52]]},"tank.enemy.default.d":{UP:[[524,460,52,60],[588,460,52,60]],DOWN:[[780,460,52,60],[844,460,52,60]],LEFT:[[648,464,60,52],[712,464,60,52]],RIGHT:[[904,464,60,52],[968,464,60,52]]},"tank.enemy.danger.a":{UP:[[524,788,52,60],[588,788,52,60]],DOWN:[[780,788,52,60],[844,788,52,60]],LEFT:[[648,796,60,52],[712,796,60,52]],RIGHT:[[908,792,60,52],[972,792,60,52]]},"tank.enemy.danger.b":{UP:[[524,852,52,60],[588,852,52,60]],DOWN:[[780,856,52,60],[844,856,52,60]],LEFT:[[648,860,60,52],[712,860,60,52]],RIGHT:[[908,856,60,52],[972,856,60,52]]},"tank.enemy.danger.c":{UP:[[524,920,52,60],[588,920,52,60]],DOWN:[[776,920,52,60],[840,920,52,60]],LEFT:[[648,928,60,52],[712,928,60,52]],RIGHT:[[908,924,60,52],[972,924,60,52]]},"tank.enemy.danger.d":{UP:[[524,984,52,60],[588,984,52,60]],DOWN:[[780,984,52,60],[844,984,52,60]],LEFT:[[648,988,60,52],[712,988,60,52]],RIGHT:[[904,988,60,52],[968,988,60,52]]},"tank.enemy.primary.d":{UP:[[4,460,52,60],[68,460,52,60]],DOWN:[[264,460,52,60],[328,460,52,60]],LEFT:[[128,464,60,52],[196,464,60,52]],RIGHT:[[388,464,60,52],[456,464,60,52]]},"tank.enemy.secondary.d":{UP:[[4,984,52,60],[68,984,52,60]],DOWN:[[264,984,52,60],[328,984,52,60]],LEFT:[[128,988,60,52],[196,988,60,52]],RIGHT:[[388,988,60,52],[456,988,60,52]]},"tank.player.primary.a":{UP:[[4,8,52,52],[68,8,52,52]],DOWN:[[264,4,52,52],[328,4,52,52]],LEFT:[[136,4,52,52],[204,4,52,52]],RIGHT:[[392,4,52,52],[460,4,52,52]]},"tank.player.primary.b":{UP:[[4,64,52,64],[68,64,52,64]],DOWN:[[264,64,52,64],[328,64,52,64]],LEFT:[[128,68,64,52],[196,68,64,52]],RIGHT:[[388,68,64,52],[456,68,64,52]]},"tank.player.primary.c":{UP:[[4,132,52,60],[68,132,52,60]],DOWN:[[264,136,52,60],[328,136,52,60]],LEFT:[[128,136,60,52],[196,136,60,52]],RIGHT:[[392,136,60,52],[460,136,60,52]]},"tank.player.primary.d":{UP:[[4,200,56,60],[68,200,56,60]],DOWN:[[264,200,56,60],[328,200,56,60]],LEFT:[[128,204,60,56],[196,204,60,56]],RIGHT:[[392,204,60,56],[460,204,60,56]]},"tank.player.secondary.a":{UP:[[4,532,52,52],[68,532,52,52]],DOWN:[[264,528,52,52],[328,528,52,52]],LEFT:[[136,528,52,52],[204,528,52,52]],RIGHT:[[392,528,52,52],[460,528,52,52]]},"tank.player.secondary.b":{UP:[[4,588,52,64],[68,588,52,64]],DOWN:[[264,588,52,64],[328,588,52,64]],LEFT:[[128,592,64,52],[196,592,64,52]],RIGHT:[[388,592,64,52],[456,592,64,52]]},"tank.player.secondary.c":{UP:[[4,656,52,60],[68,656,52,60]],DOWN:[[264,660,52,60],[328,660,52,60]],LEFT:[[128,660,60,52],[196,660,60,52]],RIGHT:[[392,660,60,52],[460,660,60,52]]},"tank.player.secondary.d":{UP:[[4,724,56,60],[68,724,56,60]],DOWN:[[264,724,56,60],[328,724,56,60]],LEFT:[[128,728,60,56],[196,728,60,56]],RIGHT:[[392,728,60,56],[460,728,60,56]]},"powerup.helmet":[[1052,448,64,60]],"powerup.clock":[[1116,448,64,60]],"powerup.shovel":[[1180,448,64,60]],"powerup.star":[[1244,448,64,60]],"powerup.grenade":[[1308,448,64,60]],"powerup.tank":[[1372,448,64,60]],"powerup.gun":[[1436,448,64,60]],"points.100":[[1180,640,64,64]],"points.200":[[1244,640,64,64]],"points.300":[[1308,640,64,64]],"points.400":[[1372,640,64,64]],"points.500":[[1436,640,64,64]],"ui.enemy":[[1308,768,32,32]],"ui.player":[[1536,576,28,32]],"ui.pause":[[1184,704,156,28]],"ui.gameOver":[[1184,736,124,60]]},Se=[p.CONCRETE,p.CONCRETE_TOP,p.CONCRETE_RIGHT,p.CONCRETE_BOTTOM,p.CONCRETE_LEFT,p.CONCRETE_LEFT_BOTTOM,p.CONCRETE_RIGHT_BOTTOM],Te=[p.BRICK,p.BRICK_TOP,p.BRICK_RIGHT,p.BRICK_BOTTOM,p.BRICK_LEFT,p.BRICK_LEFT_BOTTOM,p.BRICK_RIGHT_BOTTOM],ye={[E.Loading]:pe,[E.MainMenu]:me,[E.LevelSelector]:de,[E.GameStart]:ue,[E.Pause]:Ee,[E.Score]:ge,[E.GameOverPopup]:ce},ve={[L.PLAYER1]:{posX:18,posY:50,color:c.Yellow,variant:"PLAYER1"},[L.PLAYER2]:{posX:34,posY:50,color:c.Lime,variant:"PLAYER2"}},b={0:[0,6,12],12:[4,8]},m=fe;class we extends A{constructor(e){super();r(this,"currentScreen");r(this,"view");r(this,"activeAnimations",new Set);this.game=e,this.view=e.view}load(){this.reset()}unload(){this.reset()}reset(){this.clearAllListeners();for(const e of this.activeAnimations)clearInterval(e);this.activeAnimations=new Set,this.clearScreen(),delete this.currentScreen}show(e,t=null){const o=ye[e];this.currentScreen instanceof o||(this.currentScreen=new o(this)),this.currentScreen.show(t)}clearScreen(){this.view.eraseAllEntitiesOnLayer("overlay")}renderElement(e){const t=new k(e);return this.game.loop.registerTimerHandlers(t),this.view.add(t),t.render(),t}renderSplashScreen(e=c.Black){this.renderElement({posX:0,posY:0,width:this.view.width,height:this.view.height,color:e})}animate(e,t=25){let o=0;const n=setInterval(()=>{e(++o)||(this.activeAnimations.delete(n),clearInterval(n))},t);this.activeAnimations.add(n)}}class M extends A{constructor(e){super();r(this,"posX",0);r(this,"posY",0);r(this,"width",0);r(this,"height",0);r(this,"direction",u.UP);r(this,"role","neutral");r(this,"type","custom");r(this,"alignedToGrid",!0);r(this,"spawned",!1);r(this,"movable",!1);r(this,"flying",!1);r(this,"crossable",!1);r(this,"hittable",!0);r(this,"color",c.Grey);r(this,"shouldBeDestroyed",!1);r(this,"destroyedBy",null);r(this,"invincible",!1);r(this,"mainSpriteCoordinates",null);r(this,"mainSpriteFrame",0);r(this,"animationList",[]);Object.assign(this,e)}setState(e){this.emit(a.SHOULD_UPDATE,e),Object.assign(this,e),this.emit(a.DID_UPDATE,e)}getRect(){return{posX:this.posX,posY:this.posY,width:this.width,height:this.height}}spawn(e){const{posX:t,posY:o}=e||{posX:this.posX,posY:this.posY},n={hasCollision:void 0,nextRect:{posX:t,posY:o,width:this.width,height:this.height}};return this.emit(a.WILL_HAVE_NEW_POS,n),n.hasCollision?this.type==="projectile"&&this.explode():(this.setState({posX:t,posY:o}),this.spawned=!0,this.emit(a.SPAWN)),this.spawned}despawn(){!this.spawned||(this.shouldBeDestroyed=!0,this.emit(a.SHOULD_BE_DESTROYED),this.emit(a.DESPAWN),this.spawned=!1)}explode(){this.emit(a.EXPLODING),this.despawn()}takeDamage(e,t){this.emit(a.DAMAGED,{...t,source:e})}startAnimation(e){var t,o;(t=e.name)!=null||(e.name=Math.random().toString()),(o=e.spriteFrame)!=null||(e.spriteFrame=0),this.animationList.push(e),this.setLoopInterval(()=>{this.refreshSprite()},e.delay,e.name),this.emit(a.ANIMATION_STARTED,e.name),e.stopTimer&&this.setLoopDelay(this.cancelAnimation.bind(this,"showEntity",e.name),e.stopTimer)}cancelAnimation(e="eraseEntity",t){this.clearLoopInterval(t);const o=this.animationList.findIndex(n=>n.name===t);if(this.animationList.splice(o,1),this.emit(a.ANIMATION_ENDED,t),e==="showEntity"){this.refreshSprite();return}e==="eraseEntity"&&this.emit(a.SHOULD_UPDATE)}refreshSprite(){this.emit(a.SHOULD_UPDATE),this.emit(a.DID_UPDATE)}setLoopInterval(e,t,o){this.emit(a.SET_LOOP_INTERVAL,e,t,o)}clearLoopInterval(e){this.emit(a.CLEAR_LOOP_INTERVAL,e)}setLoopDelay(e,t){this.emit(a.SET_LOOP_DELAY,e,t)}}class G extends M{constructor(e){super(e);r(this,"moving",!1);r(this,"stopping",!1);r(this,"canMove",!0);r(this,"lastRect",null);r(this,"nextRect",null);r(this,"movePace",2);r(this,"moveSpeed",3);r(this,"moveStepsProgress",0);r(this,"moveStepsTotal",12);r(this,"nextDirection",u.UP);r(this,"moveLoops",0);r(this,"frozen",!1);this.movable=!0}getMoveSteps(){return this.moveStepsTotal-this.moveSpeed}getMoveStepPace(){return this.movePace/this.getMoveSteps()}move(e){this.moving=!0,this.nextDirection=e,this.spawned&&!this.frozen&&this.emit(a.MOVE)}stop(){this.moving=!1,this.moveStepsProgress&&(this.stopping=!0),this.emit(a.STOP)}turn(e=this.nextDirection){this.direction!==e&&(this.emit(a.STOP),this.moving&&this.emit(a.MOVE),this.setState({direction:e}),this.moveLoops=0)}update(){if(!this.spawned||this.frozen||(this.stateCheck(),this.shouldBeDestroyed)||!this.moving&&!this.stopping&&!this.shouldBeDestroyed)return;if(this.moveStepsProgress!==0){this.moveStep();return}const o=this.stopping?!1:this.direction!==this.nextDirection,n=this.moveLoops>this.getMoveSteps();o?n?this.turn():this.turnWithInterrupt():(this.prepareToMove(),this.moveStep())}turnWithInterrupt(){this.turn(),++this.moveStepsProgress,this.canMove=!1}prepareToMove(){this.lastRect=this.getRect();const e={...this.lastRect,...this.getNextMove(!0)},t={hasCollision:void 0,nextRect:e};this.emit(a.WILL_HAVE_NEW_POS,t),t.hasCollision?(this.canMove=!1,this.nextRect=null):(this.canMove=!0,this.nextRect=e)}getNextMove(e=!1){let t=0;switch(e?t=this.movePace:t=this.getMoveStepPace(),this.direction){case u.UP:return{posY:this.posY-t};case u.DOWN:return{posY:this.posY+t};case u.LEFT:return{posX:this.posX-t};case u.RIGHT:return{posX:this.posX+t}}}moveStep(){++this.moveStepsProgress>=this.getMoveSteps()?(this.moveStepsProgress=0,this.alignedToGrid=!0,this.stopping=!1,this.canMove&&this.nextRect&&(this.setState(this.nextRect),++this.moveLoops)):(this.alignedToGrid=!1,this.canMove?(this.setState(this.getNextMove()),++this.moveLoops):this.refreshSprite())}}class z extends M{constructor(e){super({posX:0,posY:0});r(this,"variant","PROJECTILE_EXPLOSION");r(this,"parent");r(this,"despawnTime",200);this.type="explosion",this.crossable=!0,this.hittable=!1,this.color=c.Transparent,this.parent=e.parent,Object.assign(this,this.calculateProps(e));let t=0;switch(this.variant){case"PROJECTILE_EXPLOSION":this.mainSpriteCoordinates=m.projectileExplosion;break;case"TANK_EXPLOSION":this.mainSpriteCoordinates=m.tankExplosion,t=16;break}this.registerExplosionEvents({animationDelay:t})}registerExplosionEvents({animationDelay:e}){this.on(a.SPAWN,()=>{this.startAnimation({delay:e,spriteCoordinates:this.mainSpriteCoordinates,looped:!1}),this.on(a.ANIMATION_ENDED,this.despawn.bind(this)),this.setLoopDelay(this.despawn.bind(this),this.despawnTime)})}calculateProps({parent:e}){const t=e.type==="projectile"?4:8,o=e.type==="projectile"?"PROJECTILE_EXPLOSION":"TANK_EXPLOSION";let n=e.posX,h=e.posY;const l=e.direction===u.UP||e.direction===u.LEFT?-2:0;return e.direction===u.UP||e.direction===u.DOWN?e.type==="tank"?(e.direction===u.UP&&(n+=l,h+=l-2),e.direction===u.DOWN&&(n+=l-2,h+=l-2)):(n-=1,h+=l):e.type==="tank"?(e.direction===u.RIGHT&&(n+=l,h+=l-2),e.direction===u.LEFT&&(n+=l,h+=l)):(n+=l,h-=1),{variant:o,posX:n,posY:h,width:t,height:t}}}class Le extends M{constructor(e){super(e);r(this,"destroyed",!1);Object.assign(this,e),this.type="flag",this.color=c.White,this.crossable=!1,this.hittable=!0,this.mainSpriteCoordinates=m["base.heart.alive"],this.registerFlagEvents()}registerFlagEvents(){this.on(a.DAMAGED,({source:e})=>{this.destroyed||(this.mainSpriteCoordinates=m["base.heart.dead"],this.refreshSprite(),this.emit(a.DESTROYED,e),this.destroyed=!0)})}}class _ extends G{constructor(e){super(e);r(this,"width",2);r(this,"height",2);r(this,"movePace",2);r(this,"moveSpeed",1);r(this,"moveStepsTotal",5);r(this,"exploding",!1);r(this,"explosionRadius",1);r(this,"explosionForce",1);r(this,"parent",null);Object.assign(this,e),this.type="projectile",this.color=c.Red,this.mainSpriteCoordinates=m.projectile,this.flying=!0,this.moving=!0,this.nextDirection=this.direction,this.registerProjectileEvents()}registerProjectileEvents(){this.on(a.DAMAGED,()=>{this.explode()})}stateCheck(){this.exploding&&this.explode(),this.canMove?this.movePace===1&&(this.movePace=2):this.movePace===2?(this.movePace=1,this.canMove=!0,this.moveStepsProgress=0):(this.exploding=!0,this.emit(a.WILL_DO_DAMAGE,this.calculateExplosionRect()))}calculateExplosionRect(){switch(this.direction){case u.UP:return{posX:this.posX-this.explosionRadius,posY:this.posY-this.explosionForce,width:this.width+this.explosionRadius*2,height:this.height};case u.DOWN:return{posX:this.posX-this.explosionRadius,posY:this.posY+this.explosionForce,width:this.width+this.explosionRadius*2,height:this.height};case u.LEFT:return{posX:this.posX-this.explosionForce,posY:this.posY-this.explosionRadius,width:this.width,height:this.height+this.explosionRadius*2};case u.RIGHT:return{posX:this.posX+this.explosionForce,posY:this.posY-this.explosionRadius,width:this.width,height:this.height+this.explosionRadius*2}}}}class Oe extends M{constructor(e){super({posX:0,posY:0});r(this,"points",100);r(this,"despawnTime",100);this.type="score",this.crossable=!0,this.hittable=!1,this.color="transparent",Object.assign(this,this.calculateProps(e)),this.registerScoreEvents()}registerScoreEvents(){this.on(a.SPAWN,()=>{this.setLoopDelay(()=>{this.despawn()},this.despawnTime)})}calculateProps({points:e,parent:t}){let o;switch(e){case 500:o=m["points.500"];break;case 400:o=m["points.400"];break;case 300:o=m["points.300"];break;case 200:o=m["points.200"];break;case 100:o=m["points.100"];break;default:o=null}return{mainSpriteCoordinates:o,posX:t.posX,posY:t.posY,width:t.width,height:t.height}}}class P extends G{constructor(e){super({...e,type:"tank"});r(this,"width",4);r(this,"height",4);r(this,"movePace",2);r(this,"moveSpeed",3);r(this,"moveStepsTotal",12);r(this,"shootSpeed",2);r(this,"spawnTimeout",1e3);r(this,"canShoot",!1);r(this,"shooting",!1);r(this,"frozen",!0);r(this,"invincible",!1);r(this,"sliding",!1);r(this,"slidingStepsProgress",0);r(this,"slidingStepsTotal",20);Object.assign(this,e),this.color=e.color||c.Yellow,this.registerTankEvents()}registerTankEvents(){this.on(a.SPAWN,()=>{this.startAnimation({delay:50,spriteCoordinates:m.spawn,looped:!0,stopTimer:this.spawnTimeout});const e=this.color;this.color=c.LightCyan,this.hittable=!1,this.setLoopDelay(()=>{this.frozen=!1,this.canShoot=!0,this.hittable=!0,this.color=e,this.emit(a.READY)},this.spawnTimeout)}),this.on(a.DAMAGED,({source:e})=>{!this.invincible&&this.role!==e.role&&(this.explode(),this.destroyedBy=e,this.emit(a.DESTROYED,e))})}setMoveSpeed(e){switch(e){case y.Low:this.moveSpeed=0;break;case y.Medium:this.moveSpeed=3;break;case y.High:this.moveSpeed=6;break}}setShootSpeed(e){switch(e){case y.Low:this.shootSpeed=1;break;case y.Medium:this.shootSpeed=2;break;case y.High:this.shootSpeed=3;break}}shoot(){!this.spawned||!this.canShoot||(this.shooting=!0,this.canShoot=!1)}stateCheck(){if(this.sliding&&(!this.canMove||++this.slidingStepsProgress>this.slidingStepsTotal?this.sliding=!1:this.stopping=!0),!this.shooting)return;const e=new _({parent:this,...this.calculateProjectileInitPos(),role:this.role,direction:this.direction,moveSpeed:this.shootSpeed});e.on(a.EXPLODING,()=>{this.canShoot=!0}),this.emit(a.SHOOT,e),this.shooting=!1}calculateProjectileInitPos(){const e={width:2,height:2},t=this.nextRect||this.lastRect||this.getRect(),o=Math.round((t.width-e.width)/2),n=Math.round((t.height-e.height)/2);switch(this.direction){case u.UP:return{posX:t.posX+o,posY:t.posY};case u.DOWN:return{posX:t.posX+o,posY:t.posY+t.height-e.height};case u.LEFT:return{posX:t.posX,posY:t.posY+n};case u.RIGHT:return{posX:t.posX+t.width-e.width,posY:t.posY+n}}}slide(e=!0){e?(this.sliding||this.emit(a.SLIDE),this.sliding=!0,this.slidingStepsProgress=0):this.sliding=!1}}class V extends P{constructor(e){super(e);r(this,"lastDirection",u.DOWN);r(this,"variant","BASIC");this.color=c.Aqua,this.role="enemy",this.setMoveSpeed(y.Low),this.setShootSpeed(y.Low),Object.assign(this,e),this.mainSpriteCoordinates=m["tank.enemy.default.a"],this.registerTankEnemyEvents()}registerTankEnemyEvents(){this.on(a.READY,()=>{this.move(u.DOWN),this.autoMove(),this.autoShoot()})}autoMove(){this.setLoopDelay(()=>{this.spawned&&(this.move(this.getMoveDirection()),this.autoMove())},F(500,1e3))}autoShoot(){this.setLoopDelay(()=>{this.spawned&&(this.shoot(),this.autoShoot())},F(500,1e3))}getRandomDirection(){const e=[...new Array(1).fill(u.UP),...new Array(6).fill(u.DOWN),...new Array(3).fill(u.LEFT),...new Array(3).fill(u.RIGHT)];return e[Math.floor(Math.random()*e.length)]}getRandomAction(){const e=[...new Array(1).fill("turn"),...new Array(5).fill("move")];return e[Math.floor(Math.random()*e.length)]}getMoveDirection(){if(this.canMove&&this.getRandomAction()==="move")return this.direction;let e;do e=this.getRandomDirection();while(this.lastDirection===e||e===u.UP&&this.posY===2||e===u.DOWN&&this.posY===50||e===u.LEFT&&this.posX===2||e===u.RIGHT&&this.posX===50);return this.lastDirection=e,e}}class j extends P{constructor(e){super(e);r(this,"spawnShieldTimeout",3e3);r(this,"variant","PLAYER1");this.role="player",this.setMoveSpeed(y.Medium),this.setShootSpeed(y.Medium),Object.assign(this,e),!e.variant||e.variant==="PLAYER1"?this.mainSpriteCoordinates=m["tank.player.primary.a"]:this.mainSpriteCoordinates=m["tank.player.secondary.a"],this.registerTankPlayerEvents()}registerTankPlayerEvents(){this.on(a.READY,()=>{this.useShield(this.spawnShieldTimeout)})}useShield(e){this.startAnimation({delay:50,spriteCoordinates:m.shield,looped:!0,stopTimer:e,showMainSprite:!0}),this.invincible=!0,this.setLoopDelay(()=>{this.invincible=!1},e)}}class $ extends M{constructor(e){super(e);r(this,"variant","WHOLE");switch(Object.assign(this,e),this.role="neutral",this.type){case"boundary":this.crossable=!1,this.hittable=!0,this.color=c.Grey;break;case"brickWall":this.crossable=!1,this.hittable=!0,this.color=c.Brown,this.mainSpriteCoordinates=m["terrain.brick"][this.variant];break;case"concreteWall":this.crossable=!1,this.hittable=!0,this.color=c.LightGrey,this.mainSpriteCoordinates=m["terrain.concrete"][this.variant];break;case"trees":this.crossable=!0,this.hittable=!1,this.color=c.Green,this.mainSpriteCoordinates=m["terrain.trees"];break;case"water":this.crossable=!1,this.hittable=!1,this.color=c.Blue,this.mainSpriteCoordinates=m["terrain.water"];break;case"ice":this.crossable=!0,this.hittable=!1,this.color=c.AliceBlue,this.mainSpriteCoordinates=m["terrain.ice"];break}this.registerTerrainEvents()}registerTerrainEvents(){this.type==="water"&&this.on(a.SPAWN,()=>{this.startAnimation({delay:350,spriteCoordinates:m["terrain.water"],looped:!0})})}}class k extends M{constructor(e){super(e);r(this,"text","");r(this,"align","left");r(this,"backImg",null);r(this,"spawned",!0);r(this,"indicatorName","");this.type=e.indicatorName?"indicator":"custom",Object.assign(this,e)}render(){const e={posX:this.posX,posY:this.posY};this.text?this.emit(a.SHOULD_RENDER_TEXT,e):(this.emit(a.SHOULD_UPDATE,e),this.emit(a.DID_UPDATE,e))}}const J=[[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,1,0,1,0,1,6,1,0,1,0,1,0],[0,1,0,1,0,2,0,2,0,1,0,1,0],[0,2,0,2,0,4,0,4,0,2,0,2,0],[4,0,4,4,0,2,0,2,0,4,4,0,4],[7,0,2,2,0,4,0,4,0,2,2,0,7],[0,4,0,4,0,1,1,1,0,4,0,4,0],[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,1,0,1,0,2,0,2,0,1,0,1,0],[0,1,0,1,0,18,4,17,0,1,0,1,0],[0,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,6,0,0,0,6,0,0,0,0,0],[0,1,0,6,0,0,0,1,0,1,0,1,0],[0,1,0,0,0,0,1,1,0,1,6,1,0],[0,0,0,1,0,0,0,0,0,6,0,0,0],[11,0,0,1,0,0,6,0,0,1,11,1,6],[11,11,0,0,0,1,0,0,6,0,11,0,0],[0,1,1,1,11,11,11,6,0,0,11,1,0],[0,0,0,6,11,1,0,1,0,1,0,1,0],[6,1,0,6,0,1,0,1,0,1,6,1,0],[0,1,0,1,0,1,1,1,0,1,6,1,0],[0,1,0,1,0,1,1,1,0,0,0,0,0],[0,1,0,0,0,18,4,17,0,1,0,1,0],[0,1,0,1,0,3,15,5,0,1,1,1,0]],[[0,0,0,0,1,0,0,1,0,0,0,0,0],[0,11,11,11,1,0,0,0,0,0,9,9,9],[1,11,11,11,0,0,0,0,0,0,0,0,0],[11,11,11,11,0,0,0,1,0,1,1,1,5],[11,11,11,11,1,1,1,2,0,1,0,3,0],[11,11,11,11,0,0,1,0,0,0,0,3,0],[0,11,0,0,0,0,6,6,6,0,0,11,0],[0,4,0,4,0,0,0,0,0,11,11,11,11],[1,5,3,1,5,3,2,2,2,11,11,11,11],[0,0,0,0,0,1,0,4,4,11,11,11,11],[1,0,0,10,0,0,0,2,2,11,11,11,0],[1,1,0,10,0,18,4,17,0,11,11,11,0],[6,1,1,0,0,3,15,5,0,1,0,0,0]],[[0,11,11,0,0,0,0,0,0,0,0,11,0],[11,11,0,0,4,1,1,4,4,0,0,0,11],[11,0,0,3,1,1,1,1,1,1,4,0,7],[7,0,0,1,1,1,1,1,1,1,1,5,0],[0,0,3,2,0,0,0,2,1,1,0,5,0],[13,0,3,0,10,0,10,0,1,5,0,0,0],[0,0,1,0,4,4,0,0,1,5,0,13,13],[0,0,1,1,1,1,1,1,1,1,0,0,0],[0,3,1,1,1,1,1,1,1,1,5,0,0],[0,2,2,1,1,1,1,1,1,2,2,0,0],[0,1,1,4,2,1,1,2,4,1,1,0,11],[11,0,2,2,0,18,4,17,2,2,0,11,11],[6,11,0,0,0,3,15,5,0,0,11,11,6]],[[0,0,0,0,1,1,0,0,0,0,0,0,0],[9,0,4,0,1,0,0,0,7,7,6,0,0],[6,0,1,0,0,0,1,0,0,0,0,0,0],[1,0,1,1,1,0,1,1,0,13,13,0,13],[2,0,0,0,2,0,0,0,0,13,0,0,0],[0,0,4,0,13,13,0,13,13,13,0,1,1],[1,1,0,0,13,1,0,1,5,0,0,0,0],[0,0,0,0,13,0,0,0,0,0,8,10,0],[13,13,13,0,13,0,6,0,1,0,8,0,0],[0,0,0,4,4,0,0,0,0,0,8,1,1],[0,0,0,0,1,2,2,2,1,4,0,0,0],[1,1,2,0,0,18,4,17,0,2,1,0,0],[2,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,0,3,0,5,11,11,0,0,0],[0,5,8,0,5,0,0,0,3,11,5,3,11],[0,5,8,0,5,0,1,0,3,11,5,3,11],[0,1,0,0,1,0,6,0,1,11,0,1,11],[0,0,0,3,7,0,1,0,2,10,0,11,11],[1,1,5,0,0,11,1,11,0,0,3,1,1],[0,0,0,0,3,11,11,11,5,0,0,0,0],[6,1,1,0,2,11,11,11,2,3,1,1,6],[7,7,7,0,4,0,11,0,4,0,7,7,7],[0,1,0,0,1,0,0,0,1,0,0,0,0],[0,1,5,0,0,2,0,2,0,0,0,0,11],[0,0,2,0,0,18,4,17,0,0,11,11,11],[0,0,4,0,0,3,15,5,0,0,4,11,11]],[[0,0,0,0,0,0,0,7,7,0,0,0,0],[0,0,6,7,7,7,0,0,0,0,6,0,0],[0,0,6,0,0,0,11,0,7,6,6,0,0],[0,6,0,0,0,11,6,0,0,0,6,0,0],[0,0,0,0,11,6,6,0,0,0,7,6,0],[0,6,0,11,6,6,6,0,6,0,0,0,0],[0,8,0,6,6,0,0,0,6,6,0,0,0],[10,0,0,0,6,0,6,6,6,0,0,8,0],[0,8,6,0,0,0,6,6,11,0,0,6,0],[0,6,0,0,0,0,6,11,0,0,6,6,0],[0,7,7,6,0,0,11,0,0,6,0,0,0],[0,0,0,0,0,18,4,17,0,7,0,9,6],[9,9,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,1,0,0,1,0,4,0,1,0,0,0],[11,1,1,1,0,1,0,9,0,1,5,0,0],[11,11,11,0,0,2,0,1,0,2,0,3,5],[11,13,13,13,13,13,13,13,13,13,13,0,13],[0,1,0,0,0,0,4,4,0,0,0,0,0],[0,0,1,0,0,3,1,1,2,1,2,7,7],[1,1,0,1,0,3,1,1,11,1,9,9,1],[0,0,0,6,0,9,0,11,11,11,11,0,0],[13,13,0,13,13,13,13,13,0,13,13,13,13],[11,11,0,3,0,0,4,4,0,0,0,0,0],[11,11,1,0,3,0,0,3,0,9,4,1,0],[11,9,1,0,3,18,4,17,0,2,0,1,0],[0,0,0,0,0,3,15,5,0,4,0,2,0]],[[0,0,0,1,0,0,0,0,0,9,11,0,0],[1,0,0,0,0,0,9,11,8,6,10,0,1],[0,0,0,9,11,8,6,10,0,7,0,0,0],[0,0,8,6,10,0,7,0,0,0,0,0,0],[0,0,0,7,11,0,0,0,0,0,0,0,0],[0,0,0,11,9,11,0,11,9,11,0,0,0],[6,1,0,8,6,10,0,8,6,10,0,1,6],[0,0,0,11,7,11,0,11,7,11,0,0,0],[0,0,0,0,9,0,0,0,9,0,0,0,0],[1,0,0,8,6,10,0,8,6,10,0,0,1],[1,0,0,11,7,11,0,11,7,11,0,0,1],[0,0,4,0,0,18,4,17,0,0,4,0,0],[0,0,1,1,0,3,15,5,0,1,1,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,3,2,1,0,0,0,0,0,0,1,2,5],[3,2,0,0,1,0,11,11,0,1,0,0,3],[1,0,0,0,1,11,11,11,11,1,0,0,3],[1,0,0,3,1,11,6,6,11,1,5,0,1],[3,4,4,1,13,13,13,13,13,13,1,1,1],[0,1,1,1,6,6,1,6,6,1,1,1,5],[0,0,1,1,6,0,1,0,6,1,1,5,0],[0,0,1,1,1,1,1,1,1,1,1,5,0],[1,11,2,2,2,6,6,2,2,2,2,11,1],[1,11,11,11,11,11,11,11,11,11,11,11,1],[0,0,11,11,11,18,4,17,11,11,11,11,0],[0,0,0,5,0,3,15,5,0,0,5,0,0]],[[0,0,0,0,0,6,0,1,0,1,1,0,0],[0,3,1,1,1,1,0,1,0,0,0,0,0],[0,0,0,5,0,1,0,1,1,0,11,11,11],[0,3,0,0,0,0,0,6,0,11,11,11,11],[0,3,0,1,1,1,6,1,1,11,11,2,6],[0,2,2,2,6,0,0,1,0,11,11,0,3],[3,1,1,1,0,6,11,11,11,11,11,0,0],[0,0,0,6,0,0,11,11,11,11,11,1,0],[6,1,0,11,11,11,11,6,11,11,11,1,0],[3,1,11,11,11,11,11,0,0,0,0,1,5],[0,1,11,11,0,0,0,0,7,1,1,1,0],[0,0,11,11,0,18,4,17,0,1,0,3,0],[0,4,11,11,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,0,0,0,1,1,1,0,0,0],[0,1,1,1,4,0,4,0,0,1,0,0,0],[0,0,0,0,1,0,2,0,0,0,0,1,1],[0,13,13,13,13,13,0,1,5,0,0,1,7],[0,0,9,9,9,13,0,1,0,6,10,1,0],[1,0,1,1,1,13,13,13,0,13,1,1,0],[0,0,0,0,6,13,0,0,0,13,7,0,0],[13,13,13,0,13,13,1,1,0,13,0,0,0],[0,0,0,0,0,1,7,7,0,13,13,13,0],[1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,7,7,0,0,0,1,1,0,3],[1,0,0,0,0,18,4,17,0,1,0,0,1],[0,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,4,0,0,0,4,0,0,0,0],[0,1,1,1,1,0,0,0,1,1,1,1,0],[0,1,0,0,0,0,1,0,0,0,0,6,0],[0,6,0,1,2,0,0,0,2,1,0,1,1],[0,1,0,5,11,9,6,9,11,3,0,6,1],[0,2,0,0,11,11,11,11,11,0,0,7,1],[1,9,0,0,11,11,11,11,11,0,0,4,1],[1,6,0,5,11,7,6,7,11,3,0,1,0],[1,1,0,1,4,0,0,0,4,1,0,6,0],[1,6,0,0,0,0,1,0,0,0,0,1,0],[1,1,1,1,1,0,0,0,1,1,1,6,6],[1,1,0,0,2,18,4,17,2,0,0,1,0],[1,1,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[11,11,0,0,4,1,1,1,4,0,0,11,11],[11,0,0,3,1,1,1,1,1,5,0,0,11],[0,0,0,1,1,11,1,11,1,1,0,0,0],[0,0,0,1,11,11,1,11,11,1,0,0,0],[11,0,0,1,1,1,1,1,1,1,0,0,11],[11,11,0,0,1,11,1,11,1,0,0,11,11],[13,13,13,0,1,1,1,1,1,0,13,13,13],[0,0,0,0,3,3,3,3,3,0,0,0,0],[0,0,0,0,5,5,5,5,5,0,0,0,0],[8,8,8,0,0,0,0,0,0,0,10,10,10],[5,5,5,0,0,18,4,17,0,0,3,3,3],[10,10,10,8,0,3,15,5,0,10,8,8,8]],[[0,0,0,0,1,1,0,0,1,0,0,0,0],[0,11,11,1,1,0,0,0,1,0,0,0,0],[11,11,11,11,11,11,11,11,1,1,0,0,0],[11,7,1,11,1,1,1,11,11,11,11,1,6],[11,11,1,11,11,11,7,11,11,1,10,1,0],[0,11,11,1,9,11,11,11,11,1,0,1,0],[0,1,1,1,1,1,11,11,1,1,5,11,11],[8,7,1,1,11,0,0,1,2,0,0,0,11],[0,1,0,1,11,9,4,2,11,11,1,5,11],[0,1,0,0,3,1,2,11,11,1,0,0,11],[0,1,1,5,3,2,11,11,4,11,1,11,11],[0,0,1,0,11,18,4,17,1,11,2,11,0],[0,0,2,0,0,3,15,5,0,11,11,11,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,11,6,0,0,0,0,0,0,0,0],[0,0,0,11,0,11,9,0,0,0,0,0,0],[0,11,0,0,0,0,11,4,0,0,0,0,0],[0,11,11,0,0,11,0,11,9,0,0,0,0],[0,11,0,11,0,11,0,0,11,4,0,0,0],[0,11,0,0,11,0,0,0,11,11,9,0,0],[0,0,11,0,0,0,0,11,11,11,11,4,0],[0,0,0,11,0,0,11,0,11,11,11,11,0],[1,0,0,0,0,0,11,0,0,11,11,11,6],[1,1,0,0,0,0,0,11,0,11,11,11,11],[6,1,1,0,0,18,4,17,11,0,11,11,11],[6,6,1,1,0,3,15,5,11,0,0,11,11]],[[0,0,0,0,4,0,0,0,0,0,4,0,0],[0,1,0,1,1,0,0,12,12,12,1,1,0],[0,1,0,0,1,0,6,12,12,12,12,12,0],[12,12,12,10,1,0,0,1,12,12,12,12,0],[12,12,12,12,12,12,1,1,3,5,0,0,0],[0,0,8,12,12,12,12,1,3,5,0,7,7],[1,1,1,1,12,12,12,12,12,12,12,1,1],[0,0,0,1,1,12,12,12,12,10,0,0,0],[0,1,1,1,0,12,12,12,1,1,0,1,0],[12,12,12,1,12,0,0,0,0,1,0,1,0],[12,12,12,12,12,7,0,7,0,0,4,1,0],[1,12,12,12,12,18,4,17,0,1,0,0,0],[1,1,10,0,0,3,15,5,0,1,0,1,0]],[[0,0,0,0,0,0,0,0,6,6,6,11,0],[0,1,0,0,0,0,0,0,6,0,0,6,0],[1,11,1,0,0,0,1,1,1,1,0,6,0],[0,1,11,1,0,0,1,0,11,1,6,6,0],[0,0,1,0,11,6,1,11,0,1,0,0,0],[0,0,0,0,6,0,1,6,1,1,0,0,0],[0,0,1,1,6,1,0,6,0,0,0,0,0],[0,0,1,0,11,1,6,11,0,0,0,0,0],[6,6,6,11,0,1,0,0,1,1,0,0,0],[6,0,1,1,1,1,0,0,1,6,6,0,0],[6,0,0,6,0,0,0,0,0,6,1,1,0],[11,6,6,6,0,18,4,17,0,0,1,6,6],[0,0,0,0,0,3,15,5,0,0,0,6,6]],[[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1,0,1,0,1,0],[0,7,0,7,0,7,0,7,0,7,0,7,0],[4,0,4,0,1,0,0,0,1,0,4,0,4],[1,0,1,2,1,0,1,0,1,2,1,0,1],[7,0,7,0,6,0,7,0,6,0,7,0,7],[11,11,0,0,1,0,11,0,1,0,0,11,11],[11,11,11,11,1,2,11,2,1,11,11,11,11],[11,11,11,11,11,11,11,11,11,11,11,11,11],[4,0,4,0,1,11,11,11,1,0,4,0,4],[0,1,0,1,0,0,11,0,0,1,0,1,0],[0,1,0,1,0,18,4,17,0,1,0,1,0],[0,2,0,2,0,3,15,5,0,2,0,2,0]],[[0,0,0,13,0,1,0,0,1,0,1,0,0],[0,0,0,0,0,0,0,0,1,0,6,0,0],[0,0,0,13,0,4,6,0,1,0,1,0,0],[7,0,1,13,0,6,0,4,2,0,1,0,0],[0,0,1,13,0,0,0,1,0,0,0,0,0],[1,0,1,13,13,0,13,13,13,13,0,0,1],[0,0,0,4,0,0,0,11,0,13,0,7,7],[1,1,3,1,0,6,11,11,11,13,0,4,4],[2,0,3,0,0,1,11,11,11,13,0,1,0],[0,9,0,0,0,1,0,11,0,13,0,11,0],[0,1,0,9,0,2,2,2,0,0,11,11,11],[0,1,0,1,0,18,4,17,0,13,11,11,11],[0,0,0,0,0,3,15,5,0,13,0,11,0]],[[0,0,0,4,4,4,0,0,4,0,0,0,0],[0,4,1,1,1,1,1,1,1,1,0,0,0],[0,11,11,11,11,11,11,11,11,1,1,0,0],[11,11,0,0,0,0,0,0,11,11,1,1,0],[11,0,6,0,0,6,0,0,0,11,11,11,0],[11,0,6,0,0,6,0,0,0,11,11,11,0],[11,0,0,11,0,0,0,0,11,11,1,1,5],[11,11,11,11,11,11,11,11,11,1,1,1,5],[1,11,11,1,1,11,11,11,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,0,6],[6,0,1,6,1,1,1,1,1,1,5,0,6],[0,6,1,2,6,18,4,17,1,1,6,6,6],[0,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,0,11,0,0,0,0,0,0,0],[0,0,0,0,11,6,11,0,0,0,0,0,0],[0,0,11,0,0,11,0,0,11,11,0,0,0],[0,11,1,11,0,0,0,11,1,1,11,0,0],[0,0,11,1,11,0,0,0,11,11,0,0,11],[11,0,0,11,0,0,11,0,0,0,0,11,6],[1,11,0,0,0,11,6,11,0,0,11,0,11],[6,1,11,0,0,0,11,0,0,11,6,11,0],[1,11,0,0,11,0,0,0,11,0,11,0,0],[11,0,0,11,1,11,0,11,1,11,0,0,0],[0,0,0,11,1,11,0,0,11,0,0,11,0],[0,11,0,0,11,18,4,17,0,0,11,6,11],[11,6,11,0,0,3,15,5,0,11,1,11,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,6,6,0,0,0,0,0,0],[0,0,0,0,0,0,6,0,0,0,0,0,0],[0,6,6,11,11,1,6,1,11,11,6,6,0],[0,0,0,6,11,11,6,11,11,6,0,0,0],[11,0,0,0,6,11,11,11,6,0,0,0,11],[6,11,0,0,0,11,11,11,0,0,0,11,6],[11,0,0,0,9,7,11,7,9,0,0,0,11],[0,0,0,0,6,0,9,0,6,0,0,0,0],[0,0,0,6,0,0,6,0,0,6,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,18,4,17,0,0,0,0,0],[0,0,6,0,0,3,15,5,0,0,6,0,0]],[[0,0,6,0,1,7,0,0,0,0,3,0,0],[0,0,1,0,1,11,0,2,1,1,1,0,0],[0,11,11,0,1,11,3,5,0,0,0,6,6],[11,11,11,11,11,11,1,1,1,0,3,1,0],[0,0,11,11,4,4,7,1,0,3,1,2,3],[1,7,0,4,2,2,0,0,0,1,2,0,3],[3,0,4,1,12,12,12,12,12,12,12,12,12],[3,0,2,0,12,12,12,12,12,12,12,12,12],[0,0,6,0,12,12,12,12,12,12,12,12,12],[1,0,1,0,12,12,12,12,12,12,12,12,12],[3,0,1,0,12,12,12,12,12,12,12,12,12],[3,0,1,0,0,18,4,17,12,12,12,12,12],[0,0,2,0,0,3,15,5,0,12,12,12,12]],[[0,0,0,6,0,1,0,1,0,1,0,6,0],[0,1,0,1,0,0,0,0,0,6,0,0,0],[0,1,0,1,0,0,6,0,0,6,0,6,6],[0,1,0,0,0,1,0,6,1,0,0,0,6],[0,0,0,0,1,1,0,1,1,0,6,0,0],[0,0,6,0,1,0,0,1,1,0,1,1,0],[6,0,6,0,0,1,0,6,0,0,6,1,0],[0,0,1,1,0,1,0,0,0,1,6,0,0],[0,6,1,1,0,1,1,0,1,1,0,0,1],[0,1,0,0,0,1,6,0,0,0,0,1,1],[0,0,0,1,0,1,1,6,0,6,0,0,1],[1,0,1,1,0,18,4,17,0,1,6,0,0],[1,0,1,0,0,3,15,5,0,1,1,1,0]],[[0,0,13,13,0,0,0,0,0,0,0,0,0],[9,0,0,13,11,0,5,0,0,0,0,0,0],[11,9,0,0,0,0,10,0,5,0,13,13,0],[11,11,0,7,4,3,0,0,10,11,13,0,0],[11,11,11,0,0,6,4,3,0,0,0,0,9],[11,11,7,9,0,3,0,6,4,0,0,9,11],[11,7,0,0,2,6,0,3,0,7,0,11,11],[0,0,0,0,0,5,2,6,0,0,11,11,11],[0,0,13,11,8,0,0,5,2,9,7,11,11],[0,13,13,0,3,0,8,0,0,0,0,0,11],[0,0,0,0,0,0,3,0,11,13,0,0,7],[6,0,0,0,0,18,4,17,0,13,13,0,0],[0,0,0,0,0,3,15,5,0,0,0,0,6]],[[0,0,0,0,6,0,0,0,0,0,0,0,0],[6,6,0,0,6,0,0,6,6,0,0,0,0],[0,6,0,0,6,0,0,0,6,0,6,6,11],[0,6,0,0,6,6,6,0,11,0,6,0,0],[0,1,0,0,0,0,6,0,6,6,6,0,0],[11,6,6,0,6,1,6,1,1,0,0,0,0],[0,0,6,11,6,11,0,0,1,0,0,6,6],[0,0,6,0,0,11,0,0,6,0,0,6,0],[0,0,1,0,0,6,0,0,6,6,1,6,0],[11,6,6,6,11,11,1,6,6,0,1,6,0],[0,0,0,1,0,0,0,0,11,11,0,1,0],[0,0,0,6,0,18,4,17,0,11,0,1,0],[0,0,0,6,0,3,15,5,0,6,0,1,0]],[[0,0,0,0,0,0,0,0,0,0,8,10,0],[0,0,0,0,0,0,9,0,0,0,6,0,0],[0,0,0,0,0,4,11,4,0,1,5,0,0],[0,0,0,0,9,11,11,11,9,1,5,0,0],[0,0,0,4,11,11,12,11,11,1,5,0,0],[0,0,9,11,11,12,12,12,11,11,5,0,0],[0,4,11,11,12,12,12,12,12,11,11,4,0],[9,11,11,12,12,12,12,12,12,12,11,11,9],[11,11,12,12,12,12,12,12,12,12,12,11,11],[0,11,12,12,12,12,12,12,12,12,12,11,0],[0,11,12,12,12,12,12,12,12,12,12,11,0],[0,11,12,12,12,18,4,17,12,12,12,11,0],[0,11,12,12,0,3,15,5,0,12,12,11,0]],[[0,0,0,0,0,0,0,0,0,0,1,0,0],[0,1,13,13,0,6,0,1,0,0,0,0,0],[0,0,13,13,1,11,11,11,13,13,0,6,0],[0,0,0,0,0,11,11,11,13,13,1,0,0],[0,6,0,0,13,13,0,11,0,0,0,0,0],[11,11,1,0,13,13,6,0,0,0,0,1,0],[11,11,11,0,0,0,0,0,0,6,0,0,6],[0,1,13,13,0,1,0,0,0,0,0,0,0],[6,0,13,13,11,11,13,13,11,11,0,1,0],[0,0,0,0,11,0,13,13,11,11,13,13,0],[0,0,0,6,11,0,0,0,11,11,13,13,0],[0,0,1,0,1,18,4,17,0,0,0,0,0],[1,0,0,0,0,3,15,5,0,1,6,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,4,0,0,0,9,0,0],[0,9,9,0,4,11,11,9,0,4,11,4,0],[4,11,11,4,11,11,11,11,4,11,11,11,4],[11,11,11,11,11,11,11,11,11,11,11,11,11],[6,11,13,11,11,11,11,11,13,11,11,11,11],[11,11,13,13,13,11,11,11,13,13,13,11,6],[11,11,11,11,13,11,6,11,11,11,13,11,11],[11,11,11,11,11,11,11,11,11,11,11,11,11],[11,11,11,11,11,2,2,11,11,11,11,11,7],[7,11,11,11,2,0,0,2,11,11,11,7,0],[0,7,2,2,0,18,4,17,2,2,2,0,0],[0,0,0,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,13,0,0,0,0,13,0,0,0,0],[13,13,0,13,0,13,13,13,13,0,13,13,13],[11,11,1,0,0,1,0,0,13,0,13,11,13],[11,13,13,13,13,0,6,0,0,1,11,11,11],[11,11,0,13,0,0,13,0,13,13,13,13,11],[13,13,0,13,0,13,13,0,0,13,0,0,0],[0,0,1,11,1,0,1,11,0,13,0,0,13],[0,13,13,11,13,13,13,13,0,11,1,0,13],[1,0,0,1,0,0,13,0,11,11,13,0,13],[13,13,0,13,13,0,13,1,13,13,13,0,0],[0,0,1,0,11,11,0,0,11,13,0,0,13],[0,13,13,13,11,18,4,17,0,13,0,13,13],[0,13,0,0,0,3,15,5,0,0,0,0,0]],[[12,12,12,12,12,12,12,12,12,12,12,12,12],[12,12,12,12,12,12,12,12,12,12,12,12,12],[12,12,12,1,12,12,12,12,12,1,12,12,12],[12,1,0,1,0,1,12,1,0,1,0,1,12],[12,2,2,1,0,0,0,0,0,1,2,2,12],[12,12,12,1,4,1,6,1,4,1,12,12,12],[6,12,12,12,0,7,0,7,0,12,12,12,6],[12,12,12,12,0,4,0,4,0,12,12,12,12],[12,12,12,12,0,1,0,1,0,12,12,12,12],[12,12,12,1,0,0,4,0,0,1,12,12,12],[12,1,12,1,0,7,7,7,0,1,12,1,12],[0,1,4,1,0,18,4,17,0,1,4,1,0],[0,2,0,0,0,3,15,5,0,0,0,2,0]],[[0,0,0,0,6,0,0,0,0,6,0,0,0],[0,6,0,0,0,6,0,0,6,11,11,0,0],[0,0,6,0,0,0,0,6,11,9,10,0,0],[0,0,0,6,0,11,11,11,11,11,0,8,0],[0,10,0,0,6,11,11,6,11,0,0,6,0],[0,7,10,11,0,6,11,11,6,0,0,8,0],[0,0,11,11,11,11,11,0,0,6,0,0,0],[0,9,10,11,0,6,11,0,0,0,6,0,0],[0,11,11,11,6,0,6,0,9,0,0,6,0],[11,11,11,6,0,0,0,0,8,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,8,6],[0,0,0,0,0,18,4,17,0,9,10,0,0],[10,0,9,0,0,3,15,5,0,0,0,0,0]],[[0,0,0,0,5,3,0,0,0,0,0,0,0],[5,5,5,3,0,5,0,0,5,5,0,0,0],[5,5,5,1,1,0,0,0,5,1,5,0,0],[3,3,0,1,5,0,0,3,5,1,1,0,0],[0,5,0,1,3,5,0,5,1,1,1,0,0],[0,5,3,0,0,1,5,1,3,3,1,0,0],[0,5,0,0,3,1,1,5,0,5,1,0,0],[0,3,0,0,5,1,1,5,0,5,1,0,0],[0,3,2,2,0,1,1,1,0,5,5,2,1],[0,3,0,0,3,5,1,3,5,5,5,3,3],[0,0,5,0,1,3,5,1,1,0,0,3,0],[0,0,5,3,5,18,4,17,1,5,0,5,0],[0,0,5,3,0,3,15,5,0,1,1,0,0]],[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,0,1,0,0,0,0,0,0],[11,0,0,11,1,11,1,11,0,0,11,0,0],[1,11,11,1,1,1,1,1,11,11,1,11,0],[1,1,1,1,6,1,6,1,1,1,1,11,0],[13,13,13,1,1,1,1,1,13,13,13,11,0],[13,1,1,1,1,1,1,1,1,1,13,13,11],[1,1,1,13,1,1,1,13,1,1,1,11,11],[1,1,13,13,13,1,13,13,13,1,1,13,13],[11,13,13,11,11,11,11,11,13,13,11,13,11],[0,11,11,0,0,0,0,0,11,11,0,11,0],[0,0,0,0,0,18,4,17,0,0,0,0,0],[0,0,0,0,0,3,15,5,0,0,0,0,0]]],Pe="\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435 \u0434\u043B\u044F \u0438\u0433\u0440\u044B \u0432 \u0442\u0435\u0447\u0435\u043D\u0438\u0435 \u043C\u0438\u043D\u0443\u0442\u044B. \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043E\u0442\u043C\u0435\u043D\u0435\u043D\u0430. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443.",Ae="\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435 \u0434\u043B\u044F \u0438\u0433\u0440\u044B. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443.";var q=(i=>(i.brickBg="/assets/img/bricks.png",i.classicDesignSprite="/assets/img/sprite.png",i))(q||{}),Q=(i=>(i.levelIntro="/assets/sounds/level-intro.mp3",i.gameOver="/assets/sounds/game-over.mp3",i.pause="/assets/sounds/pause.mp3",i.move="/assets/sounds/tank-move.mp3",i.idle="/assets/sounds/tank-idle.mp3",i.ice="/assets/sounds/ice.mp3",i.shoot="/assets/sounds/shoot.mp3",i.hitEnemy="/assets/sounds/hit-enemy.mp3",i.hitBrick="/assets/sounds/hit-brick.mp3",i.hitSteel="/assets/sounds/hit-steel.mp3",i.playerExplosion="/assets/sounds/player-explosion.mp3",i.enemyExplosion="/assets/sounds/enemy-explosion.mp3",i.score="/assets/sounds/score.mp3",i.score2="/assets/sounds/score.mp3",i))(Q||{});const Re={...q,...Q},H={images:["png","svg","jpg","jpeg","gif"],sounds:["mp3"]};class De{constructor(){r(this,"imageList",{});r(this,"soundList",{})}loadAll(s=Re,e=6e4){const t=setTimeout(()=>{alert(Pe)},e);return Promise.all(Object.entries(s).map(o=>this.load(o))).then(()=>!0).catch(()=>(alert(Ae),!1)).finally(()=>clearTimeout(t))}getImage(s){return this.imageList[s]}getSound(s){return this.soundList[s]}load(s){const[e,t]=s;return new Promise((o,n)=>{let h;const l=this.getAssetType(t);l==="image"?(h=new Image,this.imageList[e]=h,h.onload=()=>{o(h)}):l==="sound"?(h=new Audio,this.soundList[e]=h,h.oncanplaythrough=()=>{o(h)}):n(),h&&(h.onerror=n,h.src=t)})}getAssetType(s){var t;const e=(t=s.split(".").pop())!=null?t:"unknown";return H.images.includes(e)?"image":H.sounds.includes(e)?"sound":"unknown"}}const O=new De;class Me extends A{constructor(){super();r(this,"isStopped",!1);r(this,"isMuteKeyPressed",!1);r(this,"isPauseKeyPressed",!1);r(this,"activeSounds",new Set);this.registerGlobalEvents()}load(){this.isStopped=!1,this.isMuteKeyPressed=!1,this.isPauseKeyPressed=!1,this.reset()}unload(){this.reset()}reset(){this.activeSounds.forEach(e=>{this.stopSound(e)})}registerGlobalEvents(){this.on("levelIntro",()=>{this.playSound("levelIntro")}),this.on("gameOver",()=>{this.pauseSoundAll(),this.playSound("gameOver")});let e=!1;this.on("score",()=>{e?this.playSound("score2"):this.playSound("score"),e=!e}),this.on("pause",({isMuteKey:t=!1})=>{t?this.isMuteKeyPressed=!this.isMuteKeyPressed:this.isPauseKeyPressed=!this.isPauseKeyPressed,!(this.isMuteKeyPressed&&!t||this.isPauseKeyPressed&&t)&&(this.isStopped?(this.isStopped=!1,this.playSound("pause"),this.resumeSoundAll()):(this.pauseSoundAll(),this.isMuteKeyPressed||this.playSound("pause"),this.isStopped=!0))})}add(e){const t=e instanceof P,o=e.role==="player",n=e.role==="enemy",h=e instanceof $;t&&o?(e.on(a.READY,()=>{e.moving?this.playSound("move"):this.playSound("idle")}),e.on(a.SHOOT,()=>{this.playSound("shoot")}),e.on(a.MOVE,()=>{this.stopSound("idle"),this.playSound("move")}),e.on(a.STOP,()=>{this.stopSound("move"),this.playSound("idle")}),e.on(a.SLIDE,()=>{this.playSound("ice")}),e.on(a.DESTROYED,()=>{this.stopSound("move"),this.stopSound("idle"),this.playSound("playerExplosion")})):h&&(e.type==="brickWall"&&e.on(a.DAMAGED,l=>{l.source.role==="player"&&this.playSound("hitBrick")}),(e.type==="boundary"||e.type==="concreteWall")&&e.on(a.DAMAGED,l=>{l.source.role==="player"&&this.playSound("hitSteel")})),t&&n&&e.on(a.DESTROYED,()=>{this.playSound("enemyExplosion")})}isPlaying(e){return e.currentTime>=0&&!e.paused&&!e.ended}playSound(e){const t=O.getSound(e);t&&!this.isStopped&&((e==="idle"||e==="move"||e==="ice")&&(t.volume=.5),t.currentTime=0,t.play().catch(()=>{}),this.activeSounds.add(e),t.addEventListener("ended",()=>{e==="idle"||e==="move"?this.playSound(e):this.activeSounds.delete(e)}))}stopSound(e){const t=O.getSound(e);t&&this.isPlaying(t)&&(t.pause(),t.currentTime=0,this.activeSounds.delete(e))}pauseSound(e){const t=O.getSound(e);!this.isStopped&&t&&this.isPlaying(t)&&t.pause()}pauseSoundAll(){this.activeSounds.forEach(e=>{this.pauseSound(e)})}resumeSound(e){const t=O.getSound(e);t&&!this.isStopped&&t.play().catch(()=>{})}resumeSoundAll(){this.activeSounds.forEach(e=>{this.resumeSound(e)})}}const Z={KeyP:[d.PAUSE],KeyM:[d.MUTE],KeyF:[d.FULLSCREEN],Escape:[d.ESCAPE]},X={KeyW:[d.MOVE,u.UP],KeyA:[d.MOVE,u.LEFT],KeyS:[d.MOVE,u.DOWN],KeyD:[d.MOVE,u.RIGHT],Space:[d.SHOOT],...Z},W={ArrowUp:[d.MOVE,u.UP],ArrowLeft:[d.MOVE,u.LEFT],ArrowDown:[d.MOVE,u.DOWN],ArrowRight:[d.MOVE,u.RIGHT],Enter:[d.SHOOT],...Z},D=class extends A{constructor(){super();r(this,"inited",!1);r(this,"paused",!1);r(this,"loop");r(this,"zone");r(this,"view");r(this,"audioManager");r(this,"overlay");r(this,"scenario");r(this,"controllerAll");r(this,"controllerWasd");r(this,"controllerArrows");r(this,"statistics");r(this,"settings",{width:62,height:56,boundarySize:2,indicatorsSidebarSize:6});r(this,"screen",E.Loading);r(this,"mainMenuState",T.SINGLEPLAYER);r(this,"level",1);r(this,"maxLevels",J.length);this.loop=new xe,this.zone=new _e(this.settings),this.view=new be(this.settings),this.overlay=new we(this),this.audioManager=new Me,this.controllerAll=new N({...X,...W}),this.controllerWasd=new N(X),this.controllerArrows=new N(W),this.statistics=new Ye(this)}static create(){return D.__instance||(D.__instance=new D),D.__instance}init(e){this.unload(),this.load(e),this.initLoading()}load(e){this.createView(e),this.overlay.load(),this.loop.load(),this.audioManager.load(),this.controllerAll.load(),this.controllerWasd.load(),this.controllerArrows.load(),this.statistics.load(),this.inited=!0}unload(){this.clearAllListeners(),this.loop.unload(),this.view.unload(),this.overlay.unload(),this.audioManager.unload(),this.controllerAll.unload(),this.controllerWasd.unload(),this.controllerArrows.unload(),this.statistics.unload(),this.inited=!1,this.paused=!1}reset(){this.scenario&&delete this.scenario,this.loop.reset(),this.zone.reset(),this.view.reset(),this.overlay.reset(),this.audioManager.reset(),this.controllerAll.reset(),this.controllerWasd.reset(),this.controllerArrows.reset(),this.statistics.reset(),this.paused=!1}createView(e){this.view.load(e)}addEntity(e){this.loop.add(e),this.view.add(e),this.zone.add(e),this.audioManager.add(e),this.statistics.add(e)}togglePause(e=null){!this.inited||(e===!1||this.paused?(this.overlay.clearScreen(),this.loop.start(),this.controllerWasd.load(),this.controllerArrows.load()):(e===!0||!this.paused)&&(this.overlay.show(E.Pause),this.loop.stop(),this.controllerWasd.unload(),this.controllerArrows.unload()),this.paused=!this.paused,this.audioManager.emit("pause",this.paused))}initLoading(){this.screen=E.Loading,this.overlay.show(this.screen),O.loadAll().then(()=>{this.view.spriteImg=O.getImage("classicDesignSprite"),this.initMenu()})}initMenu(){this.reset(),this.screen=E.MainMenu,this.overlay.show(this.screen,this.mainMenuState),this.controllerAll.on(d.FULLSCREEN,()=>{this.view.toggleFullScreen()}).on(d.MOVE,e=>{this.screen===E.MainMenu&&(e===u.UP?this.mainMenuState=T.SINGLEPLAYER:e===u.DOWN&&(this.mainMenuState=T.MULTIPLAYER),this.overlay.show(this.screen,this.mainMenuState))}).on(d.SHOOT,async()=>{this.screen===E.MainMenu&&(await this.initLevelSelector(),this.initGameLevel(!0))})}initLevelSelector(){return new Promise(e=>{this.reset(),this.screen=E.LevelSelector,this.overlay.show(E.LevelSelector,{level:this.level,showHints:!0});let t;const o=()=>t&&clearInterval(t),n=h=>{let l=!1;(h===u.UP||h===u.RIGHT)&&this.level<this.maxLevels?(this.level++,l=!0):(h===u.DOWN||h===u.LEFT)&&this.level>1?(this.level--,l=!0):o(),l&&this.overlay.show(E.LevelSelector,{level:this.level})};this.controllerAll.on(d.STOP,()=>{this.screen===E.LevelSelector&&o()}).on(d.MOVE,h=>{this.screen===E.LevelSelector&&(o(),n.call(this,h),t=setInterval(n.bind(this,h),130))}).on(d.SHOOT,()=>{this.screen===E.LevelSelector&&e()}).on(d.ESCAPE,()=>{this.initMenu()})})}initGameIntro(){return new Promise(e=>{this.overlay.show(E.LevelSelector,{level:this.level,showHints:!1}),this.audioManager.emit("levelIntro"),this.controllerAll.on(d.SHOOT,e),setTimeout(e,2e3)}).then(()=>{this.controllerAll.offAll(d.SHOOT),this.screen=E.GameStart,this.overlay.show(this.screen)})}async initGameLevel(e=!1){this.reset(),e?this.statistics.startSession(this.mainMenuState===T.SINGLEPLAYER?"SINGLEPLAYER":"MULTIPLAYER"):this.level<this.maxLevels?this.level++:this.level=1,await this.initGameIntro(),this.statistics.startMap(),this.scenario=new ke(this).on(f.GAME_OVER,async()=>{this.statistics.finishSession(),await this.initGameOverPopup(),await this.initGameScore(),this.initMenu()}).on(f.MISSION_ACCOMPLISHED,async()=>{await le(1e3),this.statistics.finishMap(),await this.initGameScore(),this.initGameLevel()}),this.controllerAll.on(d.PAUSE,()=>{this.togglePause()}).on(d.MUTE,()=>{this.audioManager.emit("pause",{isMuteKey:!0})}).on(d.FULLSCREEN,()=>{this.view.toggleFullScreen()})}initGameScore(){return new Promise(e=>{const t=this.statistics.getCurrentStatistics();this.reset(),this.screen=E.Score,this.overlay.show(this.screen,{level:this.level,...t});const o=7e3;this.overlay.on("score",()=>{this.audioManager.emit("score")});const n=()=>{this.overlay.show(this.screen,{level:this.level,...t,skip:!0}),this.controllerAll.offAll(d.ESCAPE),this.controllerAll.on(d.ESCAPE,e),this.controllerAll.offAll(d.SHOOT),this.controllerAll.on(d.SHOOT,e)};this.controllerAll.on(d.ESCAPE,n),this.controllerAll.on(d.SHOOT,n),setTimeout(e,o)})}initGameOverPopup(){return new Promise(e=>{if(this.screen===E.GameOverPopup)return;const t=3e3;this.screen=E.GameOverPopup,this.overlay.show(this.screen),this.audioManager.emit("gameOver"),this.controllerAll.reset(),this.controllerWasd.reset(),this.controllerArrows.reset(),this.controllerAll.on(d.ESCAPE,e),setTimeout(e,t)})}};let Y=D;r(Y,"__instance");const C={PLAYER1:{header:"1\u2009\u0418",posY:30},PLAYER2:{header:"2\u2009\u0418",posY:37}};var w=(i=>(i.TankEnemy="ENEMY_TANK_ICON",i.Lives="LIVES",i.PlayerHeader="PLAYER_HEADER",i.PlayerIcon="PLAYER_ICON",i.Flag="FLAG",i.Level="LEVEL",i))(w||{});class Ie{constructor(s){r(this,"tankEnemiesLeftRendered",!1);r(this,"layerName","ceiling");this.game=s,this.renderLevel(s.level)}renderTankEnemiesLeft(s){if(!this.tankEnemiesLeftRendered){let e=2,t=56;for(let o=0;o<s;o++)t=K(o)?58:56,e=o%2?e:e+2,this.renderElement({posX:t,posY:e,width:2,height:2,color:c.Black,mainSpriteCoordinates:m["ui.enemy"],indicatorName:w.TankEnemy});this.tankEnemiesLeftRendered=!0;return}this.removeEntity(w.TankEnemy)}renderPlayerLives(s,e){this.removeEntity(s+w.Lives),this.renderElement({posX:56,posY:C[s].posY,width:4,height:2,color:c.Black,text:C[s].header,indicatorName:w.PlayerHeader}),this.renderElement({posX:56,posY:C[s].posY+2,width:2,height:2,color:c.Orange,mainSpriteCoordinates:m["ui.player"],indicatorName:w.PlayerIcon}),this.renderElement({posX:58.3,posY:C[s].posY+2,width:4,height:2,color:c.Black,text:e.toString(),indicatorName:s+w.Lives})}renderLevel(s){this.renderElement({posX:56,posY:44,width:4,height:4,color:c.Orange,mainSpriteCoordinates:m.flag,indicatorName:w.Flag}),this.renderElement({posX:s>9?57:58,posY:48,width:4,height:2,color:c.Black,text:s.toString(),indicatorName:w.Level})}removeEntity(s){const e=[...this.game.view.layers[this.layerName].entities].findLast(o=>{if(o.instance instanceof k&&o.instance.indicatorName===s)return!0}),t=e==null?void 0:e.instance;t instanceof k&&t.indicatorName===s&&(this.game.view.eraseFromLayer(t,this.layerName),this.game.view.removeEntityFromLayer(t,this.layerName))}renderElement(s){const e=new k(s);return this.game.view.add(e),e.render(),e}}class xe{constructor(){r(this,"loopTimeMs",16);r(this,"loopCount",0);r(this,"loopDelays",{});r(this,"loopIntervals",{});r(this,"loopEntities",new Set);r(this,"active",!1);r(this,"lastTimestamp",0)}load(){this.start()}unload(){this.clearLoopEntities(),this.clearLoopDelays(),this.stop()}reset(){this.clearLoopEntities(),this.loopIntervals={},this.clearLoopDelays()}start(){this.active=!0,this.loop()}stop(){this.active=!1}add(s){if(this.registerTimerHandlers(s),s instanceof P)this.loopEntities.add(s);else if(s instanceof _){const e=Array.from(this.loopEntities);e.unshift(s),this.loopEntities=new Set(e)}}clearLoopEntities(){for(const s of this.loopEntities)s.despawn();this.loopEntities=new Set}loop(s=0){if(!!this.active){if(s&&s-this.lastTimestamp>=this.loopTimeMs){++this.loopCount,this.checkLoopDelays(),this.checkLoopIntervals();for(const t of this.loopEntities)t.update(),t.shouldBeDestroyed&&this.loopEntities.delete(t);this.lastTimestamp=s}requestAnimationFrame(this.loop.bind(this))}}convertTimeToLoops(s){return Math.floor(s/this.loopTimeMs)}setLoopDelay(s,e){let t=this.loopCount+this.convertTimeToLoops(e);t===this.loopCount&&++t,this.loopDelays[t]||(this.loopDelays[t]=[]),this.loopDelays[t].push(s)}clearLoopDelays(){this.loopCount=0,this.loopDelays={}}setLoopInterval(s,e,t){return this.loopIntervals[t]={loopCounter:0,targetLoop:this.convertTimeToLoops(e),callback:s},t}clearLoopInterval(s){s in this.loopIntervals&&delete this.loopIntervals[s]}registerTimerHandlers(s){s.on(a.SET_LOOP_DELAY,this.setLoopDelay.bind(this)),s.on(a.SET_LOOP_INTERVAL,this.setLoopInterval.bind(this)),s.on(a.CLEAR_LOOP_INTERVAL,this.clearLoopInterval.bind(this))}checkLoopDelays(){if(this.loopDelays[this.loopCount]){const s=this.loopDelays[this.loopCount];for(const e of s)e();delete this.loopDelays[this.loopCount]}}checkLoopIntervals(){Object.values(this.loopIntervals).forEach(s=>{if(s.loopCounter===s.targetLoop){s.callback(),s.loopCounter=0;return}s.loopCounter++})}}class Ce{constructor(s){r(this,"mapData",J);this.gameSettings=s}fixMapData(s){return this.clearSpawnPlaces(s),s}coordToPos(s){return s*4+this.gameSettings.boundarySize}coordsToRect(s,e){return{posX:this.coordToPos(s),posY:this.coordToPos(e)}}getMap(s){const e=this.mapData[s-1];return this.fixMapData(e)}mapDataToEntitySettings(s){const e=[];return s.forEach((t,o)=>{t.forEach((n,h)=>{let l=null;if(Se.includes(n))l="concreteWall";else if(Te.includes(n))l="brickWall";else if(n===p.FOREST)l="trees";else if(n===p.WATER)l="water";else if(n===p.ICE)l="ice";else if(n===p.BASE)l="flag";else return;const g={type:l,width:4,height:4,posX:this.coordToPos(h),posY:this.coordToPos(o)};(g.type==="brickWall"||g.type==="concreteWall")&&this.updateWallProps(g,n),e.push(g)})}),e}updateWallProps(s,e){if(!s.width||!s.height)return;const t=2;switch(e){case p.BRICK_TOP:case p.CONCRETE_TOP:s.variant="TOP",s.height-=t;break;case p.BRICK_BOTTOM:case p.CONCRETE_BOTTOM:s.variant="BOTTOM",s.posY+=t,s.height-=t;break;case p.BRICK_LEFT:case p.CONCRETE_LEFT:s.variant="LEFT",s.width-=t;break;case p.BRICK_RIGHT:case p.CONCRETE_RIGHT:s.variant="RIGHT",s.posX+=t,s.width-=t;break;case p.BRICK_LEFT_BOTTOM:case p.CONCRETE_LEFT_BOTTOM:s.variant="LEFT_BOTTOM",s.posY+=t,s.width-=t,s.height-=t;break;case p.BRICK_RIGHT_BOTTOM:case p.CONCRETE_RIGHT_BOTTOM:s.variant="RIGHT_BOTTOM",s.posX+=t,s.posY+=t,s.width-=t,s.height-=t;break;default:s.variant="WHOLE";break}}clearSpawnPlaces(s){for(const e in b)for(const t of b[e])s[e][t]=p.BLANK}}class ke extends A{constructor(e){super();r(this,"state",{enemiesLeft:20,maxActiveEnemies:4,enemies:[],players:{}});r(this,"mapManager");r(this,"map");r(this,"indicatorManager");for(this.game=e,this.createBoundaries(),this.mapManager=new Ce(e.settings),this.map=this.mapManager.getMap(e.level),this.indicatorManager=new Ie(e),this.game.mainMenuState===T.SINGLEPLAYER?this.createPlayerTank(L.PLAYER1):this.game.mainMenuState===T.MULTIPLAYER&&(this.state.maxActiveEnemies=6,this.createPlayerTank(L.PLAYER1),this.createPlayerTank(L.PLAYER2)),this.mapManager.mapDataToEntitySettings(this.map).forEach(o=>{this.createEntity(o)});this.canCreateTankEnemy();)this.createTankEnemy();this.initEventListeners()}initEventListeners(){this.on(f.TANK_ENEMY_DESTROYED,({source:e,destination:t})=>{this.createExplosion(t),this.state.enemies=this.state.enemies.filter(o=>o!==t),Object.values(this.state.players).find(({entity:o})=>o===e),this.canCreateTankEnemy()?this.createTankEnemy():this.state.enemies.length===0&&this.emit(f.MISSION_ACCOMPLISHED)}).on(f.TANK_PLAYER_DESTROYED,(e,t)=>{this.createExplosion(e);const o=this.state.players[t];if(--o.lives,this.indicatorManager.renderPlayerLives(t,o.lives),Object.values(this.state.players).every(h=>h.lives<1)){this.emit(f.GAME_OVER);return}o.lives>0&&this.createPlayerTank(t)}).on(f.PROJECTILE_HIT,e=>{this.createExplosion(e)})}canCreateTankEnemy(){return this.state.enemies.length<this.state.maxActiveEnemies&&this.state.enemiesLeft!==0}createEntity(e){let t;return e.type==="flag"?t=new Le(e).on(a.DESTROYED,()=>{this.emit(f.GAME_OVER)}):t=new $(e),this.game.addEntity(t),t.spawn(e),t}createBoundaries(){const{settings:e}=this.game;this.createEntity({type:"boundary",width:e.width,height:e.boundarySize,posX:0,posY:0}),this.createEntity({type:"boundary",width:e.width,height:e.boundarySize,posX:0,posY:e.height-e.boundarySize}),this.createEntity({type:"boundary",width:e.boundarySize,height:e.height-e.boundarySize*2,posX:0,posY:e.boundarySize}),this.createEntity({type:"boundary",width:e.boundarySize+e.indicatorsSidebarSize,height:e.height-e.boundarySize*2,posX:e.width-e.boundarySize-e.indicatorsSidebarSize,posY:e.boundarySize})}getGameController(e){if(this.game.mainMenuState===T.MULTIPLAYER){if(e===L.PLAYER1)return this.game.controllerWasd;if(e===L.PLAYER2)return this.game.controllerArrows}return this.game.controllerAll}trySpawnTankEnemy(e){const t=Math.floor(Math.random()*b[0].length),o=this.mapManager.coordsToRect(b[0][t],0);e.spawn(o)||this.game.loop.setLoopDelay(this.trySpawnTankEnemy.bind(this,e),200)}createTankEnemy(){--this.state.enemiesLeft,this.indicatorManager.renderTankEnemiesLeft(this.state.enemiesLeft);const e=new V({role:"enemy",color:c.Pink});e.on(a.SPAWN,()=>{e.on(a.SHOOT,this.onTankShoot.bind(this)).on(a.DESTROYED,t=>{this.emit(f.TANK_ENEMY_DESTROYED,{source:t.parent,destination:e})})}),this.state.enemies.push(e),this.emit(f.TANK_ENEMY_SPAWNED,e),this.game.addEntity(e),this.trySpawnTankEnemy(e)}initPlayerState(e){this.state.players[e]={lives:2,controller:this.getGameController(e)},this.indicatorManager.renderPlayerLives(e,this.state.players[e].lives)}createPlayerTank(e=L.PLAYER1){e in this.state.players||this.initPlayerState(e);const t=ve[e],o=this.state.players[e],n=new j(t);return o.entity=n,this.game.addEntity(n),n.on(a.DESTROYED,()=>{this.emit(f.TANK_PLAYER_DESTROYED,n,e)}).on(a.SHOOT,this.onTankShoot.bind(this)).spawn(t),this.on(f.GAME_OVER,()=>{n&&n.spawned&&n.stop()}),o.controller.offAll(d.MOVE).on(d.MOVE,h=>{n.move(h)}).offAll(d.STOP).on(d.STOP,()=>{n.stop()}).offAll(d.SHOOT).on(d.SHOOT,()=>{!this.game.paused&&n.shoot()}),n}onTankShoot(e){this.game.paused||this.createProjectile(e)}createProjectile(e){if(!e)return null;this.game.addEntity(e),e.spawn({posX:e.posX,posY:e.posY}),e.update(),e.on(a.EXPLODING,()=>{this.emit(f.PROJECTILE_HIT,e)})}createExplosion(e){const t=new z({parent:e});this.game.addEntity(t),t.spawn()}}class Ye{constructor(s){r(this,"game");r(this,"mode","SINGLEPLAYER");r(this,"active",!1);r(this,"highestScore",2e4);r(this,"sessionScore",[0,0]);r(this,"sessionCompletedMaps",0);r(this,"sessionElapsedTime",0);r(this,"mapScore",[0,0]);r(this,"mapEnemiesKilledCount",{BASIC:[0,0],FAST:[0,0],POWER:[0,0],ARMOR:[0,0]});r(this,"mapElapsedTime",0);r(this,"mapStartTime",0);this.game=s}load(){this.sessionScore=[0,0],this.sessionCompletedMaps=0,this.sessionElapsedTime=0,this.reset()}unload(){this.finishSession(),this.reset()}reset(){this.mapScore=[0,0],this.mapEnemiesKilledCount={BASIC:[0,0],FAST:[0,0],POWER:[0,0],ARMOR:[0,0]},this.mapElapsedTime=0}updateLeaderboard(){this.mode==="SINGLEPLAYER"&&this.game.emit(B.UpdateLeaderboard,{score:this.sessionScore[0],matches:this.sessionCompletedMaps,time:this.sessionElapsedTime})}getCurrentStatistics(){const{mode:s,sessionScore:e,mapEnemiesKilledCount:t}=this,o={},n=[0,0];return Object.entries(t).forEach(h=>{const l=h[0],[g,v]=h[1],S=this.getScoreByEnemyVariant(l);o[l]=[g*S,v*S],n[0]+=g,n[1]+=v}),{mode:s,sessionScore:e,mapEnemiesKilledScore:o,mapEnemiesKilledCount:t,mapEnemiesKilledTotal:n}}getScoreByEnemyVariant(s){switch(s){case"ARMOR":return 400;case"POWER":return 300;case"FAST":return 200;case"BASIC":return 100}}getPlayerIndex(s){return s==="PLAYER1"?0:1}add(s){if(s instanceof z&&s.parent instanceof V){const e=s.parent;s.on(a.DESPAWN,()=>{const t=this.countEnemy(e),o=new Oe({points:t,parent:e});this.game.addEntity(o),o.spawn()})}}countEnemy(s){const e=this.getScoreByEnemyVariant(s.variant);if(!(s.destroyedBy instanceof _&&s.destroyedBy.parent instanceof j))return 0;const t=s.destroyedBy.parent,o=this.getPlayerIndex(t.variant);return this.sessionScore[o]+=e,this.mapScore[o]+=e,++this.mapEnemiesKilledCount[s.variant][o],e}countBonus(){}startSession(s){this.active||(this.active=!0,this.mode=s,this.load())}finishSession(){!this.active||(this.finishMap(!0),this.active=!1)}startMap(){this.mapStartTime=Date.now()}finishMap(s=!1){this.mapElapsedTime=Date.now()-this.mapStartTime,this.sessionElapsedTime+=this.mapElapsedTime,s||++this.sessionCompletedMaps,this.updateLeaderboard()}}class be extends A{constructor({width:e,height:t}){super();r(this,"width",0);r(this,"height",0);r(this,"pixelRatio",10);r(this,"gameBgColor",c.Black);r(this,"layerZIndexCount",0);r(this,"layers",{});r(this,"root");r(this,"spriteImg",null);r(this,"windowSmallerSideSize",Math.min(window.innerWidth,window.innerHeight));r(this,"canvasResizeListener",this.canvasResizeHandler.bind(this));this.width=e,this.height=t,this.pixelRatio=this.getPixelRatio()}toggleFullScreen(){document.fullscreenElement?document.exitFullscreen():this.root.requestFullscreen()}reset(){for(const e of Object.keys(this.layers))this.eraseAllEntitiesOnLayer(e)}load(e){if(e===null)throw new Error("proper DOM root for the game should be set");this.root=e,this.isRootEmpty()&&(this.createLayer("floor").style.background=this.gameBgColor,this.createLayer("tanks"),this.createLayer("projectiles"),this.createLayer("ceiling"),this.createLayer("explosions"),this.createLayer("overlay").style.position="relative"),window.addEventListener("resize",this.canvasResizeListener)}unload(){document.removeEventListener("resize",this.canvasResizeListener)}createLayer(e){const t=document.createElement("canvas");return t.id=e,t.width=this.convertToPixels(this.width),t.height=this.convertToPixels(this.height),t.style.display="block",t.style.position="absolute",t.style.zIndex=(this.layerZIndexCount++).toString(),this.root.appendChild(t),this.layers[e]?(this.layers[e].context=t.getContext("2d"),this.redrawAllEntitiesOnLayer(e)):this.layers[e]={context:t.getContext("2d"),entities:new Set},t}add(e){let t="";switch(e.type){case"custom":case"score":t="overlay";break;case"tank":t="tanks";break;case"projectile":t="projectiles";break;case"trees":case"indicator":t="ceiling";break;case"explosion":t="explosions";break;default:t="floor";break}this.bindEntityToLayer(e,t)}bindEntityToLayer(e,t){var n;const o={instance:e,listeners:{[a.SHOULD_UPDATE]:()=>{!e.spawned||this.eraseFromLayer(e,t)},[a.DID_UPDATE]:()=>{this.drawOnLayer(e,t)},[a.SHOULD_RENDER_TEXT]:()=>{this.drawTextOnLayer(e,t)},[a.SHOULD_BE_DESTROYED]:()=>{this.eraseFromLayer(e,t),this.removeEntityFromLayer(e,t)},[a.DAMAGED]:h=>{e.type==="brickWall"&&this.eraseFromLayer(h,t)}}};(n=this.layers[t])==null||n.entities.add(o);for(const[h,l]of Object.entries(o.listeners))e.on(h,l)}removeEntityFromLayer(e,t){let o=null;for(const n of this.layers[t].entities)n.instance===e&&(o=n);if(o){this.layers[t].entities.delete(o);for(const[n,h]of Object.entries(o.listeners))e.off(n,h)}}drawTextOnLayer(e,t){const o=this.layers[t].context;if(o.font=`${this.convertToPixels(e.height)-1}px "Press Start 2P"`,o.textAlign=e.align,o.textBaseline="top",e.backImg){const h=o.createPattern(e.backImg,"repeat");h!==null&&(o.fillStyle=h)}else o.fillStyle=e.color;let n=e.posX;e.align==="center"&&(n+=Math.round(e.width/2)),e.align==="right"&&(n+=e.width),o.fillText(e.text,this.convertToPixels(n),this.convertToPixels(e.posY)+1)}drawOnLayer(e,t){var n;const o=this.layers[t].context;if(!e.mainSpriteCoordinates||!this.isSpriteImgLoaded()){e.color&&(o.fillStyle=e.color,o.fillRect(...this.getActualRect(e)));return}if(!((n=e.animationList)!=null&&n.length)){this.drawMainEntitySprite(e,o);return}e.animationList.length&&e.animationList.forEach(h=>{const l=this.getSpriteCoordinates({entity:e,animation:h});!l||(h.showMainSprite&&this.drawMainEntitySprite(e,o),o.drawImage(this.spriteImg,...l,...this.getActualRect(e)),this.setNextSpriteFrame(h,e))})}drawMainEntitySprite(e,t){const o=this.getSpriteCoordinates({entity:e});!o||t.drawImage(this.spriteImg,...o,...this.getActualRect(e))}eraseFromLayer(e,t){this.layers[t].context.clearRect(...this.getActualRect(e))}redrawAllEntitiesOnLayer(e){if(!this.layers[e])return;const{entities:t}=this.layers[e];this.eraseAllEntitiesOnLayer(e);for(const o of t)this.drawOnLayer(o.instance,e)}eraseAllEntitiesOnLayer(e){if(!this.layers[e])return;const{context:t}=this.layers[e];t.clearRect(0,0,this.convertToPixels(this.width),this.convertToPixels(this.height)),this.layers[e].entities.clear()}getActualRect(e){let t=0,o=0;return"type"in e&&e.type==="tank"&&(t=2,o=-4),[this.convertToPixels(e.posX,t),this.convertToPixels(e.posY,t),this.convertToPixels(e.width,o),this.convertToPixels(e.height,o)]}getSpriteContent(e){const t=document.createElement("canvas");if(!e)return null;t.width=e[0][2],t.height=e[0][3];const o=[0,0,t.width,t.height],n=t.getContext("2d");return n==null||n.drawImage(this.spriteImg,...e[0],...o),t}getSpriteCoordinates({entity:e,animation:t}){let o=null;if(!t&&e.mainSpriteCoordinates){if(!e.movable&&Array.isArray(e.mainSpriteCoordinates))return e.mainSpriteCoordinates[0];if(e.movable&&!Array.isArray(e.mainSpriteCoordinates))return e instanceof P&&!e.moving||(e.mainSpriteFrame=+!e.mainSpriteFrame),e.mainSpriteCoordinates[e.direction][e.mainSpriteFrame]}if(t&&Array.isArray(t.spriteCoordinates))return o=t.spriteCoordinates[t.spriteFrame||0],o}setNextSpriteFrame(e,t){var l;const o=performance.now();e.lastTime||(e.lastTime=o);const n=o-e.lastTime;if(typeof e.spriteFrame!="number"||n<e.delay)return;e.lastTime=o,e.spriteFrame++;const h=e.spriteFrame===((l=e.spriteCoordinates)==null?void 0:l.length);h&&e.looped&&(e.spriteFrame=0),h&&!e.looped&&e.name&&t.cancelAnimation("eraseEntity",e.name)}isRootEmpty(){return this.root.innerHTML.trim()===""}convertToPixels(e,t=0){return Math.round(e*this.pixelRatio+t)}getPixelRatio(){const t=Math.min(this.width,this.height);let o=this.windowSmallerSideSize/t;return t*o>=this.windowSmallerSideSize&&(o-=.5),Math.round(o/.5)*.5}canvasResizeHandler(){if(!this.windowSmallerSideSize)return;const e=Math.min(window.innerWidth/this.windowSmallerSideSize,window.innerHeight/this.windowSmallerSideSize);this.root.style.transform="scale("+e*100+"%)"}isSpriteImgLoaded(){return this.spriteImg instanceof HTMLImageElement&&this.spriteImg.complete&&this.spriteImg.width>0&&this.spriteImg.height>0}}var ee=(i=>(i[i.Main=0]="Main",i[i.Secondary=1]="Secondary",i[i.Projectiles=2]="Projectiles",i[i.Powerups=3]="Powerups",i))(ee||{});class _e{constructor({width:s,height:e}){r(this,"width",0);r(this,"height",0);r(this,"matrix");this.width=s,this.height=e,this.matrix=[];for(const t of Object.values(ee))if(typeof t=="number"){this.matrix[t]=Array(this.width);for(let o=0;o<this.matrix[t].length;++o)this.matrix[t][o]=Array(this.height).fill(null)}}getLayerByEntityType(s){switch(s.type){case"ice":case"trees":return 1;case"projectile":return 2;case"powerup":return 3;default:return 0}}reset(){for(let s=0;s<this.matrix.length;++s)this.updateMatrix(s,{posX:0,posY:0,width:this.width,height:this.height},null)}add(s){this.registerEntity(s)}updateMatrix(s,e,t){if(!(this.isBeyondMatrix(e)||!this.isLegalRect(e)))for(let o=e.posX+e.width-1;o>=e.posX;--o)for(let n=e.posY+e.height-1;n>=e.posY;--n)this.matrix[s][o][n]=t}writeEntityToMatrix(s){if(s.alignedToGrid){const e=this.getLayerByEntityType(s),t=s.getRect();this.updateMatrix(e,t,s)}}deleteEntityFromMatrix(s){const e=this.getLayerByEntityType(s);if(s instanceof G){let t=s.lastRect;t?this.updateMatrix(e,t,null):(t=s.getRect(),this.updateMatrix(e,t,null)),s.nextRect&&(t=s.nextRect,this.updateMatrix(e,t,null))}else{const t=s.getRect();this.updateMatrix(e,t,null)}}registerEntity(s){s.type==="score"||s.type==="explosion"||(s.on(a.WILL_HAVE_NEW_POS,e=>{const t=e.nextRect;if(this.hasCollision(t,s))e.hasCollision=!0;else{const o=this.getLayerByEntityType(s);this.updateMatrix(o,t,s),s instanceof P&&s.sliding&&(s.sliding=this.shouldSlide(t))}}),s.on(a.SHOULD_UPDATE,e=>{!e||!("posX"in e)||!("posY"in e)||!s.spawned||this.deleteEntityFromMatrix(s)}),s.on(a.DID_UPDATE,e=>{!e||!("posX"in e)||!("posY"in e)||this.writeEntityToMatrix(s)}),s.on(a.SHOULD_BE_DESTROYED,()=>{this.deleteEntityFromMatrix(s)}),s.on(a.WILL_DO_DAMAGE,e=>{this.doDamage(e,s)}),s instanceof P&&s.on(a.STOP,()=>{s.slide(this.shouldSlide(s.nextRect||s.lastRect||s.getRect()))}),s.type==="brickWall"&&s.on(a.DAMAGED,e=>{const t=this.getLayerByEntityType(s);this.updateMatrix(t,e,null)}))}isLegalRect(s){return s.posX%1===0&&s.posY%1===0&&s.width%1===0&&s.height%1===0}isBeyondMatrix(s){return!!(this.isBeyondXAxis(s)||this.isBeyondYAxis(s))}isBeyondXAxis(s){const e=s.posX+s.width;return s.posX<0||e>this.width}isBeyondYAxis(s){const e=s.posY+s.height;return s.posY<0||e>this.height}doDamage(s,e){var t,o;for(let n=s.posX+s.width-1;n>=s.posX;--n)for(let h=s.posY+s.height-1;h>=s.posY;--h){const l=(t=this.matrix[0][n])==null?void 0:t[h],g=(o=this.matrix[2][n])==null?void 0:o[h],v={posX:n,posY:h,width:1,height:1};l&&l.hittable&&l.takeDamage(e,v),g&&g.takeDamage(e,v)}}shouldSlide(s){var e;for(let t=s.posX+s.width-1;t>=s.posX;--t)for(let o=s.posY+s.height-1;o>=s.posY;--o){const n=(e=this.matrix[1][t])==null?void 0:e[o];if(!n||n.type!=="ice")return!1}return!0}hasCollisionsWithMatrix(s,e){var t,o;for(let n=s.posX+s.width-1;n>=s.posX;--n)for(let h=s.posY+s.height-1;h>=s.posY;--h){const l=(t=this.matrix[0][n])==null?void 0:t[h],g=(o=this.matrix[2][n])==null?void 0:o[h];if(!(!l&&!g)){if(e instanceof P&&l!==null&&l!==e&&!l.crossable)return!0;if(e instanceof _){if(l!==null&&l.hittable&&l!==e.parent){if(e.role==="enemy"&&e.role===l.role)continue;return!0}if(g!==null&&g!==e){if(e.role==="enemy"&&e.role===g.role)continue;return!0}}}}return!1}hasCollision(s,e){return!!(this.isBeyondMatrix(s)||this.hasCollisionsWithMatrix(s,e))}}const Ne=i=>typeof i.hidden<"u"?"visibilitychange":typeof i.msHidden<"u"?"msvisibilitychange":typeof i.webkitHidden<"u"?"webkitvisibilitychange":"visibilitychange",Be=i=>{if(typeof i.hidden<"u")return"hidden";if(typeof i.msHidden<"u")return"msHidden";if(typeof i.webkitHidden<"u")return"webkitHidden"},U=i=>{const s=Be(i);return s&&!i[s]};function Ge(){const[i,s]=x.exports.useState(U(document)),e=()=>s(U(document));return x.exports.useEffect(()=>{const t=Ne(document);return document.addEventListener(t,e,!1),()=>{document.removeEventListener(t,e)}}),i}const We=()=>{const i=x.exports.useRef(null),s=Ge(),e=Y.create();return x.exports.useEffect(()=>(e.init(i.current),e.on(B.UpdateLeaderboard,t=>{console.log("\u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u043B\u0438\u0434\u0435\u0440\u0431\u043E\u0440\u0434\u0430:",t)}),()=>{e.unload()}),[]),x.exports.useEffect(()=>{s===!1&&!e.paused&&e.screen===E.GameStart&&e.togglePause()},[s]),he("div",{ref:i,className:"game__root"})};export{We as Game};
